/*! For license information please see 2076.674e58e2.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkqr_code_scanner=self.webpackChunkqr_code_scanner||[]).push([[2076],{2076:function(e,t,n){n.r(t),n.d(t,{DBRWeb:function(){return se}});var r=n(5861),i=n(5671),s=n(3144),a=n(136),o=n(9388),c=n(7757),u=n.n(c),d=n(7991),l=n(4671),_=n(2982),h=n(1120);function f(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=(0,h.Z)(e)););return e}function g(){return g="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=f(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},g.apply(this,arguments)}var v=n(7762);function p(e,t,n,r){return new(n||(n=Promise))((function(i,s){function a(e){try{c(r.next(e))}catch(e){s(e)}}function o(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))}var m=!!("object"==typeof global&&global.process&&global.process.release&&global.process.release.name&&"undefined"==typeof HTMLCanvasElement),R=!m&&"undefined"==typeof self,E=function(){function e(){var t=this;(0,i.Z)(this,e),this._canvasMaxWH="iPhone"==e.browserInfo.OS||"Android"==e.browserInfo.OS?2048:4096,this._singleFrameMode=!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia),this._singleFrameModeIpt=function(){var e=document.createElement("input");return e.setAttribute("type","file"),e.setAttribute("accept","image/*"),e.setAttribute("capture",""),e.addEventListener("change",(function(){return p(t,void 0,void 0,c.mark((function t(){var n;return c.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.files[0],e.value="",this.onSingleFrameAcquired(n);case 2:case"end":return t.stop()}}),t,this)})))})),e},this._clickIptSingleFrameMode=function(){t._singleFrameModeIpt().click()},this.styleEls=[],this.bSaveOriCanvas=!0,this.maxVideoCvsLength=3,this.videoCvses=[],this.videoGlCvs=null,this.videoGl=null,this.glImgData=null,this._onCameraSelChange=function(){t.play(t._selCam.value).then((function(){t._isOpen||t.stop()}))},this._onResolutionSelChange=function(){var e,n;if(t._selRsl&&-1!=t._selRsl.selectedIndex){var r=t._selRsl.options[t._selRsl.selectedIndex];e=r.getAttribute("data-width"),n=r.getAttribute("data-height")}t.play(void 0,e,n).then((function(){t._isOpen||t.stop()}))},this._onCloseBtnClick=function(){t.close()},this._isOpen=!1,this.videoSettings={video:{width:{ideal:1280},height:{ideal:720},facingMode:{ideal:"environment"}}},this.iPlayRound=0,this.promisePlay=null,this._allCameras=[],this._currentCamera=null,this._videoTrack=null,this._lastDeviceId=void 0,this._vc_bPlayingVideoBeforeHide=!1,this._ev_documentHideEvent=function(){"visible"===document.visibilityState?t._vc_bPlayingVideoBeforeHide&&("Firefox"==e.browserInfo.browser?t.play():t._video.play(),t._vc_bPlayingVideoBeforeHide=!1):t._video&&!t._video.paused&&(t._vc_bPlayingVideoBeforeHide=!0,t._video.pause())},this._video=null,this._bgLoading=null,this._selCam=null,this._bgCamera=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._region=null,this.bChangeRegionIndexManually=!1,this._regionIndex=-1,this._loopInterval=0,this._frameQueueMaxLength=1,this._frameQueue=[],this._bFetchingLoopStarted=!1,this._bStoppedByPause=!1,this.alwaysRefreshBuffer=!0,this._bufferRefreshInterval=0,this.bDestroyed=!1}return(0,s.Z)(e,[{key:"getUIElement",value:function(){return this.UIElement}},{key:"setUIElement",value:function(e){return p(this,void 0,void 0,c.mark((function t(){var n,r,i,s;return c.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!("string"==typeof e||e instanceof String)){t.next=16;break}if(e.trim().startsWith("<")){t.next=10;break}return t.next=4,fetch(e);case 4:if((n=t.sent).ok){t.next=7;break}throw Error("setUIElement(elementOrUrl): Network Error: "+n.statusText);case 7:return t.next=9,n.text();case 9:e=t.sent;case 10:if(e.trim().startsWith("<")){t.next=12;break}throw Error("setUIElement(elementOrUrl): Can't get valid HTMLElement.");case 12:for((r=document.createElement("div")).innerHTML=e,i=0;i<r.childElementCount;++i)(s=r.children[i])instanceof HTMLStyleElement&&(this.styleEls.push(s),document.head.append(s));(e=1==r.childElementCount?r.children[0]:r).remove();case 16:this.UIElement=e;case 17:case"end":return t.stop()}}),t,this)})))}},{key:"singleFrameMode",get:function(){return this._singleFrameMode},set:function(e){if(this._isOpen)throw new Error("`singleFrameMode` is not allowed to change when camera is open.");this._singleFrameMode=e}},{key:"ifSaveOriginalImageInACanvas",get:function(){return this.bSaveOriCanvas},set:function(e){this.bSaveOriCanvas=e}},{key:"_bindUI",value:function(){if(!this.UIElement)throw new Error("Need to define `UIElement` before opening.");var e,t=[this.UIElement],n=this.UIElement.children,r=(0,v.Z)(n);try{for(r.s();!(e=r.n()).done;){var i=e.value;t.push(i)}}catch(h){r.e(h)}finally{r.f()}for(var s=0;s<t.length;++s){var a,o=(0,v.Z)(t[s].children);try{for(o.s();!(a=o.n()).done;){var c=a.value;t.push(c)}}catch(h){o.e(h)}finally{o.f()}}for(var u=null,d=0,l=t;d<l.length;d++){var _=l[d];!this._video&&_.classList.contains("dce-video")?(this._video=_,this._video.setAttribute("playsinline","true")):!this._bgLoading&&_.classList.contains("dce-bg-loading")?this._bgLoading=_:!this._bgCamera&&_.classList.contains("dce-bg-camera")?this._bgCamera=_:!this._selCam&&_.classList.contains("dce-sel-camera")?this._selCam=_:!this._selRsl&&_.classList.contains("dce-sel-resolution")?(this._selRsl=_,this._selRsl.options.length||(this._selRsl.innerHTML=[this._optGotRsl?"":'<option class="dce-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">ask 1920 x 1080</option>','<option data-width="1280" data-height="720">ask 1280 x 720</option>','<option data-width="640" data-height="480">ask 640 x 480</option>'].join(""),this._optGotRsl=this._optGotRsl||this._selRsl.options[0])):!this._optGotRsl&&_.classList.contains("dce-opt-gotResolution")?this._optGotRsl=_:!this._btnClose&&_.classList.contains("dce-btn-close")?this._btnClose=_:!this._video&&_.classList.contains("dce-existingVideo")?(this._video=_,this._video.setAttribute("playsinline","true")):!u&&_.tagName&&"video"==_.tagName.toLowerCase()&&(u=_)}if(!this._video&&u&&(this._video=u),this.singleFrameMode?this._video&&(this._video.addEventListener("click",this._clickIptSingleFrameMode),this._video.style.cursor="pointer",this._video.setAttribute("title","Take a photo")):this._bgLoading&&(this._bgLoading.style.display=""),this.singleFrameMode?(this._video&&(this._video.addEventListener("click",this._clickIptSingleFrameMode),this._video.style.cursor="pointer",this._video.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="")):this._bgLoading&&(this._bgLoading.style.display=""),this._selCam&&this._selCam.addEventListener("change",this._onCameraSelChange),this._selRsl&&this._selRsl.addEventListener("change",this._onResolutionSelChange),this._btnClose&&this._btnClose.addEventListener("click",this._onCloseBtnClick),!this._video)throw this._unbindUI(),Error("Can not find HTMLVideoElement with class `dce-video`");this._isOpen=!0}},{key:"_unbindUI",value:function(){this.singleFrameMode?(this._video&&(this._video.removeEventListener("click",this._clickIptSingleFrameMode),this._video.style.cursor="",this._video.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._bgLoading&&(this._bgLoading.style.display="none"),this._selCam&&this._selCam.removeEventListener("change",this._onCameraSelChange),this._selRsl&&this._selRsl.removeEventListener("change",this._onResolutionSelChange),this._btnClose&&this._btnClose.removeEventListener("click",this._onCloseBtnClick),this._video=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._isOpen=!1}},{key:"_assertOpen",value:function(){if(!this._isOpen)throw Error("The camera is not open.")}},{key:"video",get:function(){return this._video}},{key:"region",get:function(){return this._region},set:function(e){this._region=e,this._bFetchingLoopStarted&&(this._regionIndex=-1,this._fetchingLoop(!1))}},{key:"regionIndex",get:function(){return this._regionIndex},set:function(e){this.bChangeRegionIndexManually&&(this._region instanceof Array&&this._region.length>e?this._regionIndex=e:this._regionIndex=0)}},{key:"loopInterval",get:function(){return this._loopInterval},set:function(e){e>=0&&(this._loopInterval=e),this._bFetchingLoopStarted&&this._fetchingLoop(!1)}},{key:"frameQueueMaxLength",get:function(){return this._frameQueueMaxLength},set:function(e){for(this._frameQueueMaxLength=e;this._frameQueue&&this._frameQueue.length>this._frameQueueMaxLength;)this._frameQueue.shift()}},{key:"frameQueue",get:function(){return JSON.parse(JSON.stringify(this._frameQueue))}},{key:"bufferRefreshInterval",get:function(){return this._bufferRefreshInterval},set:function(e){this._bufferRefreshInterval=e}},{key:"isContextDestroyed",value:function(){return this.bDestroyed}},{key:"play",value:function(t,n,r){return p(this,void 0,void 0,c.mark((function i(){var s,a,o=this;return c.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(this._assertOpen(),!this._video||!this.videoSrc){i.next=5;break}return i.next=3,new Promise((function(e,t){o._video.onloadedmetadata=function(){return p(o,void 0,void 0,c.mark((function t(){return c.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._video.onloadedmetadata=null,t.next=3,this._video.play();case 3:e();case 4:case"end":return t.stop()}}),t,this)})))},"string"==typeof o.videoSrc||o.videoSrc instanceof String?o._video.src=o.videoSrc:o._video.srcObject=o.videoSrc,setTimeout((function(){return t(new Error("Failed to play video. Timeout."))}),4e3)}));case 3:return s={width:this._video.videoWidth,height:this._video.videoHeight},i.abrupt("return",(this.onPlayed&&setTimeout((function(){o.onPlayed(s)}),0),s));case 5:if(!this.singleFrameMode){i.next=7;break}return i.abrupt("return",(this._clickIptSingleFrameMode(),{width:0,height:0}));case 7:if(a=++this.iPlayRound,i.t0=this.promisePlay,!i.t0){i.next=13;break}return i.next=12,this.promisePlay;case 12:i.t0=a<this.iPlayRound;case 13:if(!i.t0){i.next=17;break}i.t1={width:this._video.videoWidth,height:this._video.videoHeight},i.next=21;break;case 17:return this.promisePlay=p(o,void 0,void 0,c.mark((function i(){var s,a,o,u,d,l,_,h,f,g,m,R,E,I,A,S,b,y,T,D=this;return c.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,this._video&&this._video.srcObject&&this.stop(),e._onLog&&e._onLog("DCE: ======before video========"),i.next=5,this.getAllCameras();case 5:return a=function(){if(D.bDestroyed)throw l&&l.getTracks().forEach((function(e){e.stop()})),D._video.srcObject=null,D._videoTrack=null,D._currentCamera=null,new Error("The CameraEnhancer instance has been destroyed.")},"boolean"==typeof(o=JSON.parse(JSON.stringify(this.videoSettings))).video&&(o.video={}),n&&(o.video.width={ideal:n}),r&&(o.video.height={ideal:r}),d=["rear","back","r\xfcck","arri\xe8re","trasera","tr\xe1s","traseira","posteriore","\u540e\u9762","\u5f8c\u9762","\u80cc\u9762","\u540e\u7f6e","\u5f8c\u7f6e","\u80cc\u7f6e","\u0437\u0430\u0434\u043d\u0435\u0439","\u0627\u0644\u062e\u0644\u0641\u064a\u0629","\ud6c4","arka","achterzijde","\u0e2b\u0e25\u0e31\u0e07","baksidan","bagside","sau","bak","tylny","takakamera","belakang","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u03c0\u03af\u03c3\u03c9","spate","h\xe1ts\xf3","zadn\xed","darrere","zadn\xe1","\u0437\u0430\u0434\u043d\u044f","stra\u017enja","belakang","\u092c\u0948\u0915"],_=function(){var t,n=(0,v.Z)(D._allCameras);try{var r=function(){var e=t.value,n=e.label.toLowerCase();if(n&&d.some((function(e){return-1!=n.indexOf(e)}))&&/\b0(\b)?/.test(n))return delete o.video.facingMode,o.video.deviceId={ideal:e.deviceId},"break"};for(n.s();!(t=n.n()).done&&"break"!==r(););}catch(i){n.e(i)}finally{n.f()}o.video.deviceId||-1==["Android","HarmonyOS"].indexOf(e.browserInfo.OS)||(delete o.video.facingMode,o.video.deviceId={ideal:D._allCameras[D._allCameras.length-1].deviceId})},t?(delete o.video.facingMode,o.video.deviceId={exact:t},this._lastDeviceId=t):o.video.deviceId||(this._lastDeviceId?(delete o.video.facingMode,o.video.deviceId={exact:this._lastDeviceId}):o.video.facingMode&&((h=o.video.facingMode)instanceof Array&&h.length&&(h=h[0]),"environment"===(h=h.exact||h.ideal||h)&&(u=!!o.video.facingMode,_()))),e._onLog&&e._onLog("DCE: ======try getUserMedia========"),g=[0,500],m=null,R=null,E=function(t){return p(D,void 0,void 0,c.mark((function n(){var r,i,s;return c.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=(0,v.Z)(g),n.prev=1,s=c.mark((function n(){var r,s;return c.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=i.value,a(),n.t0=r,!n.t0){n.next=6;break}return n.next=6,new Promise((function(e){return setTimeout(e,r)}));case 6:return a(),s=t.video.deviceId,R=s?s.exact||s.ideal||s:null,n.prev=9,e._onLog&&e._onLog("DCE: ask "+JSON.stringify(t)),n.next=13,navigator.mediaDevices.getUserMedia(t);case 13:return l=n.sent,n.abrupt("return","break");case 17:n.prev=17,n.t1=n.catch(9),m=n.t1,e._onLog&&e._onLog("DCE: "+n.t1.message||0);case 20:case"end":return n.stop()}}),n,null,[[9,17]])})),r.s();case 4:if((i=r.n()).done){n.next=11;break}return n.delegateYield(s(),"t0",6);case 6:if("break"!==n.t0){n.next=9;break}return n.abrupt("break",11);case 9:n.next=4;break;case 11:n.next=16;break;case 13:n.prev=13,n.t1=n.catch(1),r.e(n.t1);case 16:return n.prev=16,r.f(),n.finish(16);case 19:case"end":return n.stop()}}),n,null,[[1,13,16,19]])})))},i.next=15,E(o);case 15:if(l){i.next=20;break}return e._onLog&&e._onLog("DCE: ======try getUserMedia again========"),"object"==typeof(f=JSON.parse(JSON.stringify(o))).video&&("iPhone"==e.browserInfo.OS?(n>=1280||r>=1280?f.video.width=1280:n>=640||r>=640?f.video.width=640:(n<640||r<640)&&(f.video.width=320),delete f.video.height):u&&!o.video.deviceId?(delete f.video.facingMode,this._allCameras.length&&(f.video.deviceId={ideal:this._allCameras[this._allCameras.length-1].deviceId})):f.video=!0),e._onLog&&e._onLog("DCE: "+f),i.next=20,E(f);case 20:if(i.t0=l,i.t0){i.next=25;break}return g=[1e3,2e3],i.next=25,E(o);case 25:if(i.t1=l,i.t1){i.next=29;break}return i.next=29,E(f);case 29:if(l){i.next=31;break}throw m;case 31:return I=function(){var e,t,n=l.getVideoTracks();if(n.length&&(e=D._videoTrack=n[0]),D._video&&e){if(e.label){var r,i=(0,v.Z)(D._allCameras);try{for(i.s();!(r=i.n()).done;){var s=r.value;if(e.label==s.label){s._checked=!0,t=s,D._lastDeviceId=s.deviceId;break}}}catch(u){i.e(u)}finally{i.f()}}if(!t&&R){var a,o=(0,v.Z)(D._allCameras);try{for(o.s();!(a=o.n()).done;){var c=a.value;if(R==c.deviceId){e.label&&(c._checked=!0,c.label=e.label),t=c,D._lastDeviceId=c.deviceId;break}}}catch(u){o.e(u)}finally{o.f()}}}D._currentCamera=t},i.next=34,this.getAllCameras();case 34:if(a(),!u){i.next=46;break}if(I(),_(),(A=o.video.deviceId)&&(A=A.exact||A.ideal||A),S=null===(s=this._currentCamera)||void 0===s?void 0:s.deviceId,i.t2=!A||S&&A==S,i.t2){i.next=46;break}return l.getTracks().forEach((function(e){e.stop()})),g=[0,500,1e3,2e3],i.next=46,E(o);case 46:return a(),b=function(){return p(D,void 0,void 0,c.mark((function t(){var n=this;return c.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e._onLog&&e._onLog("======play video========"),t.next=3,new Promise((function(e,t){n._video.onloadedmetadata=function(){return p(n,void 0,void 0,c.mark((function t(){return c.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._video.onloadedmetadata=null,t.next=3,this._video.play();case 3:e();case 4:case"end":return t.stop()}}),t,this)})))},n._video.srcObject=l,setTimeout((function(){return t(new Error("Failed to play video. Timeout."))}),4e3)}));case 3:case"end":return t.stop()}}),t)})))},i.next=50,b();case 50:return e._onLog&&e._onLog("DCE: ======played video========"),this._bgLoading&&(this._bgLoading.style.animationPlayState="paused"),y="got "+this._video.videoWidth+"x"+this._video.videoHeight,this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",this._video.videoWidth),this._optGotRsl.setAttribute("data-height",this._video.videoHeight),this._optGotRsl.innerText=y,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got")),e._onLog&&e._onLog("DCE: "+y),I(),a(),this._renderSelCameraInfo(),T={width:this._video.videoWidth,height:this._video.videoHeight},i.abrupt("return",(this.onPlayed&&setTimeout((function(){D.onPlayed(T)}),0),this.promisePlay=null,T));case 58:throw i.prev=58,i.t3=i.catch(0),this.promisePlay=null,i.t3;case 61:case"end":return i.stop()}}),i,this,[[0,58]])}))),i.next=20,this.promisePlay;case 20:i.t1=i.sent;case 21:return i.abrupt("return",i.t1);case 22:case"end":return i.stop()}}),i,this)})))}},{key:"resume",value:function(){return p(this,void 0,void 0,c.mark((function e(){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.play();case 2:this._bStoppedByPause&&(this._bStoppedByPause=!1,this.startFetchingLoop());case 3:case"end":return e.stop()}}),e,this)})))}},{key:"pause",value:function(){this._video&&this._video.pause(),this._bFetchingLoopStarted&&(this.stopFetchingLoop(),this._bStoppedByPause=!0)}},{key:"close",value:function(){return p(this,void 0,void 0,c.mark((function e(){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.stop(),this._unbindUI(),this.UIElement.style.display="none",this.stopFetchingLoop();case 1:case"end":return e.stop()}}),e,this)})))}},{key:"open",value:function(){return p(this,void 0,void 0,c.mark((function e(){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._bindUI(),this.UIElement.parentNode||(this.UIElement.style.position="fixed",this.UIElement.style.left="0",this.UIElement.style.top="0",document.body.append(this.UIElement)),"none"==this.UIElement.style.display&&(this.UIElement.style.display=""),e.next=5,this.play();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"stop",value:function(){this._video&&this._video.srcObject&&(e._onLog&&e._onLog("DCE: ======stop video========"),this._video.srcObject.getTracks().forEach((function(e){e.stop()})),this._video.srcObject=null,this._videoTrack=null,this._currentCamera=null),this._video&&this._video.classList.contains("dce-existingVideo")&&(e._onLog&&e._onLog("DCE: ======stop existing video========"),this._video.pause(),this._video.currentTime=0),this._bgLoading&&(this._bgLoading.style.animationPlayState=""),this._frameQueue.length=0}},{key:"getAllCameras",value:function(){return p(this,void 0,void 0,c.mark((function t(){var n,r,i,s,a,o,u,d,l,_,h,f;return c.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,navigator.mediaDevices.enumerateDevices();case 2:if(n=t.sent,r=[],i=[],this._allCameras){s=(0,v.Z)(this._allCameras);try{for(s.s();!(a=s.n()).done;)(o=a.value)._checked&&i.push(o)}catch(c){s.e(c)}finally{s.f()}}for(u=0;u<n.length;u++)if(d=void 0,"videoinput"==(l=n[u]).kind){_=(0,v.Z)(i);try{for(_.s();!(h=_.n()).done;)f=h.value,l.deviceId==f.deviceId&&(d=f)}catch(c){_.e(c)}finally{_.f()}d||((d={}).deviceId=l.deviceId,d.label=l.label?l.label:"camera "+u),r.push(d)}return t.abrupt("return",(this._allCameras=r,e._onLog&&e._onLog("DCE: "+JSON.stringify(this._allCameras)),Promise.resolve(r)));case 8:case"end":return t.stop()}}),t,this)})))}},{key:"_renderSelCameraInfo",value:function(){if(this._selCam&&(this._selCam.innerHTML=""),this._selCam){var e,t,n=(0,v.Z)(this._allCameras);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=document.createElement("option");i.value=r.deviceId,i.innerText=r.label,this._selCam.append(i),r.deviceId&&this._currentCamera&&this._currentCamera.deviceId==r.deviceId&&(e=i)}}catch(s){n.e(s)}finally{n.f()}this._selCam.value=e?e.value:""}}},{key:"getSelectedCamera",value:function(){return p(this,void 0,void 0,c.mark((function e(){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._currentCamera);case 1:case"end":return e.stop()}}),e,this)})))}},{key:"selectCamera",value:function(e){return p(this,void 0,void 0,c.mark((function t(){return c.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.play(e.deviceId||e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"getResolution",value:function(){return this._isOpen?[this._video.videoWidth,this._video.videoHeight]:null}},{key:"setResolution",value:function(e,t){return p(this,void 0,void 0,c.mark((function n(){var r,i;return c.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this._isOpen){n.next=7;break}return e instanceof Array?(r=e[0],i=e[1]):(r=e,i=t),n.next=4,this.play(null,r,i);case 4:n.t0=n.sent,n.next=10;break;case 7:return n.next=9,Promise.reject(new Error("The camera is not open."));case 9:n.t0=n.sent;case 10:return n.abrupt("return",n.t0);case 11:case"end":return n.stop()}}),n,this)})))}},{key:"getVideoSettings",value:function(){return JSON.parse(JSON.stringify(this.videoSettings))}},{key:"updateVideoSettings",value:function(e){return this.videoSettings=JSON.parse(JSON.stringify(e)),this._lastDeviceId=null,this._isOpen?this.play():Promise.resolve()}},{key:"isOpen",value:function(){return this._isOpen}},{key:"getCapabilities",value:function(){return this._assertOpen(),this._videoTrack.getCapabilities?this._videoTrack.getCapabilities():{}}},{key:"getCameraSettings",value:function(){return this._assertOpen(),this._videoTrack.getSettings()}},{key:"getConstraints",value:function(){return this._assertOpen(),this._videoTrack.getConstraints()}},{key:"applyConstraints",value:function(e){return p(this,void 0,void 0,c.mark((function t(){return c.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._assertOpen(),this._videoTrack.applyConstraints){t.next=2;break}throw Error("Not supported.");case 2:return t.next=4,this._videoTrack.applyConstraints(e);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"turnOnTorch",value:function(){return p(this,void 0,void 0,c.mark((function e(){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertOpen(),!this.getCapabilities().torch){e.next=4;break}return e.next=3,this._videoTrack.applyConstraints({advanced:[{torch:!0}]});case 3:return e.abrupt("return",e.sent);case 4:throw Error("Not supported.");case 5:case"end":return e.stop()}}),e,this)})))}},{key:"turnOffTorch",value:function(){return p(this,void 0,void 0,c.mark((function e(){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._assertOpen(),!this.getCapabilities().torch){e.next=4;break}return e.next=3,this._videoTrack.applyConstraints({advanced:[{torch:!1}]});case 3:return e.abrupt("return",e.sent);case 4:throw Error("Not supported.");case 5:case"end":return e.stop()}}),e,this)})))}},{key:"setColorTemperature",value:function(e){return p(this,void 0,void 0,c.mark((function t(){var n;return c.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._assertOpen(),n=this.getCapabilities().colorTemperature){t.next=4;break}throw Error("Not supported.");case 4:return e<n.min?e=n.min:e>n.max&&(e=n.max),t.next=7,this._videoTrack.applyConstraints({advanced:[{colorTemperature:e}]});case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"setExposureCompensation",value:function(e){return p(this,void 0,void 0,c.mark((function t(){var n;return c.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._assertOpen(),n=this.getCapabilities().exposureCompensation){t.next=4;break}throw Error("Not supported.");case 4:return e<n.min?e=n.min:e>n.max&&(e=n.max),t.next=7,this._videoTrack.applyConstraints({advanced:[{exposureCompensation:e}]});case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"setZoom",value:function(e){return p(this,void 0,void 0,c.mark((function t(){var n;return c.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._assertOpen(),n=this.getCapabilities().zoom){t.next=4;break}throw Error("Not supported.");case 4:return e<n.min?e=n.min:e>n.max&&(e=n.max),t.next=7,this._videoTrack.applyConstraints({advanced:[{zoom:e}]});case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"setFrameRate",value:function(e){return p(this,void 0,void 0,c.mark((function t(){var n;return c.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._assertOpen(),n=this.getCapabilities().frameRate){t.next=4;break}throw Error("Not supported.");case 4:return e<n.min?e=n.min:e>n.max&&(e=n.max),t.next=7,this._videoTrack.applyConstraints({width:{ideal:Math.max(this._video.videoWidth,this._video.videoHeight)},frameRate:e});case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"getFrameRate",value:function(){return this.getCameraSettings().frameRate}},{key:"getFrame",value:function(t){if(this.bDestroyed)throw Error("The DCE instance has been destroyed.");this._assertOpen(),e._onLog&&e._onLog("DCE: getFrame(region?)");var n,r,i=Date.now(),s=this._video.videoWidth,a=this._video.videoHeight,o=Math.max(s,a);if(o>this._canvasMaxWH){var c=this._canvasMaxWH/o;n=Math.round(s*c),r=Math.round(a*c)}else n=s,r=a;var u,d,l,_,h=0,f=0,g=s,p=a,m=s,R=a;t&&(t.regionMeasuredByPercentage?(u=t.regionLeft*n/100,d=t.regionTop*r/100,l=t.regionRight*n/100,_=t.regionBottom*r/100):(u=t.regionLeft,d=t.regionTop,l=t.regionRight,_=t.regionBottom),m=l-u,g=Math.round(m/n*s),R=_-d,p=Math.round(R/r*a),h=Math.round(u/n*s),f=Math.round(d/r*a));var E=0==h&&0==f&&s==g&&a==p&&s==m&&a==R;if(!this.bSaveOriCanvas&&E){this.videoGlCvs||(this.videoGlCvs=globalThis.OffscreenCanvas?new OffscreenCanvas(m,R):document.createElement("canvas"));var I=this.videoGlCvs;I.width==m&&I.height==R||(I.height=R,I.width=m,this.videoGl&&this.videoGl.viewport(0,0,m,R));var A=this.videoGl||I.getContext("webgl",{alpha:!1,antialias:!1,depth:!1,stencil:!1,preserveDrawingBuffer:!0})||I.getContext("experimental-webgl",{alpha:!1,antialias:!1,depth:!1,stencil:!1,preserveDrawingBuffer:!0});if(!this.videoGl){this.videoGl=A;var S=A.createShader(A.VERTEX_SHADER);A.shaderSource(S,"\nattribute vec4 a_position;\nattribute vec2 a_uv;\n\nvarying vec2 v_uv;\n\nvoid main() {\n    gl_Position = a_position;\n    v_uv = a_uv;\n}\n"),A.compileShader(S),A.getShaderParameter(S,A.COMPILE_STATUS)||console.error("An error occurred compiling the shaders: "+A.getShaderInfoLog(S));var b=A.createShader(A.FRAGMENT_SHADER);A.shaderSource(b,"\nprecision lowp float;\n\nvarying vec2 v_uv;\n\nuniform sampler2D u_texture;\n\nvoid main() {\n    vec4 sample =  texture2D(u_texture, v_uv);\n    float grey = 0.299 * sample.r + 0.587 * sample.g + 0.114 * sample.b;\n    gl_FragColor = vec4(grey, 0.0, 0.0, 1.0);\n}\n"),A.compileShader(b),A.getShaderParameter(b,A.COMPILE_STATUS)||console.error("An error occurred compiling the shaders: "+A.getShaderInfoLog(b));var y=A.createProgram();A.attachShader(y,S),A.attachShader(y,b),A.linkProgram(y),A.getProgramParameter(y,A.LINK_STATUS)||console.error("Unable to initialize the shader program: "+A.getProgramInfoLog(y)),A.useProgram(y),A.bindBuffer(A.ARRAY_BUFFER,A.createBuffer()),A.bufferData(A.ARRAY_BUFFER,new Float32Array([-1,1,0,1,1,1,1,1,-1,-1,0,0,1,-1,1,0]),A.STATIC_DRAW);var T=A.getAttribLocation(y,"a_position");A.enableVertexAttribArray(T),A.vertexAttribPointer(T,2,A.FLOAT,!1,16,0);var D=A.getAttribLocation(y,"a_uv");A.enableVertexAttribArray(D),A.vertexAttribPointer(D,2,A.FLOAT,!1,16,8),A.activeTexture(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,A.createTexture()),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,A.CLAMP_TO_EDGE),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,A.NEAREST),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,A.NEAREST),A.uniform1i(A.getUniformLocation(y,"u_texture"),0)}(!this.glImgData||this.glImgData.length<m*R*4)&&(this.glImgData=new Uint8Array(m*R*4)),A.texImage2D(A.TEXTURE_2D,0,A.RGBA,A.RGBA,A.UNSIGNED_BYTE,this._video);var C=e._onLog?Date.now():0;A.drawArrays(A.TRIANGLE_STRIP,0,4),e._onLog&&e._onLog("DCE: Grey cost: "+(Date.now()-C));var k=this.glImgData;A.readPixels(0,0,A.drawingBufferWidth,A.drawingBufferHeight,A.RGBA,A.UNSIGNED_BYTE,k);var L=e._onLog?Date.now():0,M=new Uint8Array(new Uint32Array(k.buffer));e._onLog&&e._onLog("DCE: Extract grey cost: "+(Date.now()-L));var x=Date.now();return{canvas:null,data:M,region:null,sx:0,sy:0,width:m,height:R,timeSpent:x-i,timeStamp:x}}var O=null;if(this.bSaveOriCanvas)(O=document.createElement("canvas")).width=m,O.height=R,O.dbrCtx2d=O.getContext("2d");else{var w,N=(0,v.Z)(this.videoCvses);try{for(N.s();!(w=N.n()).done;){var B=w.value;if(B.width==m&&B.height==R){O=B;break}}}catch(G){N.e(G)}finally{N.f()}O||(globalThis.OffscreenCanvas?O=new OffscreenCanvas(m,R):((O=document.createElement("canvas")).width=m,O.height=R),O.dbrCtx2d=O.getContext("2d"),this.videoCvses.length>=this.maxVideoCvsLength&&(this.videoCvses=this.videoCvses.slice(1)),this.videoCvses.push(O))}var P=O.dbrCtx2d;E?P.drawImage(this._video,0,0):P.drawImage(this._video,h,f,g,p,0,0,m,R);var F=O.dbrCtx2d||O.getContext("2d");if(0===O.width||0===O.height)return null;var U=F.getImageData(0,0,O.width,O.height).data,V=Date.now();return{data:U,canvas:O,region:t,sx:h,sy:f,width:g,height:p,timeSpent:V-i,timeStamp:V}}},{key:"getCurrentRegion",value:function(){var e;if(this._region)if(this._region instanceof Array){if(this.bChangeRegionIndexManually){if(this._regionIndex>=this._region.length)throw new Error("the 'regionIndex' should be less than the length of region array.")}else++this._regionIndex>=this._region.length&&(this._regionIndex=0);e=this._region[this._regionIndex]}else e=this._region;else e=null;return e}},{key:"_fetchingLoop",value:function(t){var n=this;if(this.bDestroyed)this.stopFetchingLoop();else if(this._isOpen&&this.isFetchingLoopStarted()){if(this._video.paused)return e._onLog&&e._onLog("DCE: Video is paused. Ask in 1s."),this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId),void(this._frameLoopTimeoutId=setTimeout((function(){n._fetchingLoop(!0)}),1e3));var r=function(){e._onLog&&e._onLog("DCE: start fetching a frame: "+Date.now());var t=n.getCurrentRegion(),r=n.getFrame(t);n._frameQueue&&n._frameQueue.length>=n._frameQueueMaxLength&&n._frameQueue.shift(),n._frameQueue.push(r),e._onLog&&e._onLog("DCE: finish fetching a frame: "+Date.now())};t&&(this._frameQueue.length<this._frameQueueMaxLength?(r(),function t(){n._frameLoopTimeoutId2&&clearTimeout(n._frameLoopTimeoutId2),n._bufferRefreshInterval<=0||(n._frameLoopTimeoutId2=setTimeout((function(){n.bDestroyed?n.stopFetchingLoop():n._isOpen&&n.isFetchingLoopStarted()?n._video.paused?n._frameLoopTimeoutId&&clearTimeout(n._frameLoopTimeoutId):(e._onLog&&e._onLog("DCE: second timeout executes: "+Date.now()),r(),t()):n.stopFetchingLoop()}),n._bufferRefreshInterval))}()):this.alwaysRefreshBuffer&&r()),this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId),this._frameLoopTimeoutId=setTimeout((function(){n._fetchingLoop(!0)}),this._loopInterval)}else this.stopFetchingLoop()}},{key:"startFetchingLoop",value:function(){if(this.bDestroyed)throw Error("The DCE instance has been destroyed.");if(this._assertOpen(),this._video.paused)throw Error("The video is paused.");this.isFetchingLoopStarted()||(this._bFetchingLoopStarted=!0,e._onLog&&e._onLog("start fetching loop: "+Date.now()),this._fetchingLoop(!0))}},{key:"isFetchingLoopStarted",value:function(){return this._bFetchingLoopStarted}},{key:"stopFetchingLoop",value:function(){this._bFetchingLoopStarted&&(e._onLog&&e._onLog("stop fetching loop: "+Date.now()),this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId),this._frameQueue.length=0,this._bFetchingLoopStarted=!1)}},{key:"getFrameFromBuffer",value:function(e){return this._frameQueue&&this._frameQueue.length?e?e<this._frameQueue.length?(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this._frameQueue.splice(e,1)[0]):void 0:(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this._frameQueue.shift()):null}},{key:"getQueueLength",value:function(){return this._frameQueue.length}}],[{key:"getVersion",value:function(){return this._version}},{key:"detectEnvironment",value:function(){return p(this,void 0,void 0,c.mark((function e(){var t;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t={wasm:"undefined"!=typeof WebAssembly&&("undefined"==typeof navigator||!(/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&/\(.+\s11_2_([2-6]).*\)/.test(navigator.userAgent))),worker:!!(m?process.version>="v12":"undefined"!=typeof Worker),getUserMedia:!("undefined"==typeof navigator||!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia),camera:!1,browser:this.browserInfo.browser,version:this.browserInfo.version,OS:this.browserInfo.OS}).getUserMedia){e.next=11;break}return e.prev=2,e.next=5,navigator.mediaDevices.getUserMedia({video:!0});case 5:e.sent.getTracks().forEach((function(e){e.stop()})),t.camera=!0,e.next=11;break;case 9:e.prev=9,e.t0=e.catch(2);case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,this,[[2,9]])})))}},{key:"engineResourcePath",get:function(){return this._engineResourcePath},set:function(t){if(this._hasEngineResourceLoaded)throw new Error("`engineResourcePath` is not allowed to change after `createInstance` is called.");if(null==t&&(t="./"),m||R)e._engineResourcePath=t;else{var n=document.createElement("a");n.href=t,e._engineResourcePath=n.href}this._engineResourcePath.endsWith("/")||(e._engineResourcePath+="/")}},{key:"defaultUIElementURL",get:function(){var t;return null===(t=this._defaultUIElementURL)||void 0===t?void 0:t.replace("@engineResourcePath/",e.engineResourcePath)},set:function(e){this._defaultUIElementURL=e}},{key:"createInstance",value:function(t){return p(this,void 0,void 0,c.mark((function n(){var r,i;return c.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!m){n.next=2;break}throw new Error("`CameraEnhancer` is not supported in Node.js.");case 2:for(i in r=new e,("string"==typeof t||t instanceof String)&&(t=JSON.parse(t)),t)r[i]=t[i];return n.next=7,r.setUIElement(this.defaultUIElementURL);case 7:return this._hasEngineResourceLoaded=!0,document.addEventListener("visibilitychange",r._ev_documentHideEvent),n.abrupt("return",r);case 10:case"end":return n.stop()}}),n,this)})))}}]),e}();E._jsVersion="2.0.3",E._jsEditVersion="20210628",E._version="JS "+E._jsVersion+"."+E._jsEditVersion,E.browserInfo=function(){if(!m&&!R){var e={init:function(){this.browser=this.searchString(this.dataBrowser)||"unknownBrowser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"unknownVersion",this.OS=this.searchString(this.dataOS)||"unknownOS","Linux"==this.OS&&-1!=navigator.userAgent.indexOf("Windows NT")&&(this.OS="HarmonyOS")},searchString:function(e){for(var t=0;t<e.length;t++){var n=e[t].string,r=e[t].prop;if(this.versionSearchString=e[t].versionSearch||e[t].identity,n){if(-1!=n.indexOf(e[t].subString))return e[t].identity}else if(r)return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(-1!=t)return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Edge",identity:"Edge"},{string:navigator.userAgent,subString:"OPR",identity:"OPR"},{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"}],dataOS:[{string:navigator.userAgent,subString:"HarmonyOS",identity:"HarmonyOS"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone"},{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};return e.init(),{browser:e.browser,version:e.version,OS:e.OS}}if(R)return{browser:"ssr",version:0,OS:"ssr"}}(),E._hasEngineResourceLoaded=!1,E._engineResourcePath=function(){if(m)return"";if(!R&&document.currentScript){var e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{var n=e.indexOf("#");-1!=n&&(e=e.substring(0,n))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}(),E._defaultUIElementURL="@engineResourcePath/dce.ui.html";var I,A,S,b,y=function(){function e(){(0,i.Z)(this,e)}return(0,s.Z)(e,null,[{key:"browserInfo",get:function(){return E.browserInfo}},{key:"getVersion",value:function(){return E.getVersion()}},{key:"detectEnvironment",value:function(){return E.detectEnvironment()}},{key:"engineResourcePath",get:function(){return E.engineResourcePath},set:function(e){E.engineResourcePath=e}},{key:"_onLog",get:function(){return E._onLog},set:function(e){E._onLog=e}}]),e}();function T(e,t,n,r){return new(n||(n=Promise))((function(i,s){function a(e){try{c(r.next(e))}catch(e){s(e)}}function o(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}c((r=r.apply(e,t||[])).next())}))}y.CameraEnhancer=E,function(e){e[e.IPF_Binary=0]="IPF_Binary",e[e.IPF_BinaryInverted=1]="IPF_BinaryInverted",e[e.IPF_GrayScaled=2]="IPF_GrayScaled",e[e.IPF_NV21=3]="IPF_NV21",e[e.IPF_RGB_565=4]="IPF_RGB_565",e[e.IPF_RGB_555=5]="IPF_RGB_555",e[e.IPF_RGB_888=6]="IPF_RGB_888",e[e.IPF_ARGB_8888=7]="IPF_ARGB_8888",e[e.IPF_RGB_161616=8]="IPF_RGB_161616",e[e.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",e[e.IPF_ABGR_8888=10]="IPF_ABGR_8888",e[e.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",e[e.IPF_BGR_888=12]="IPF_BGR_888"}(I||(I={})),function(e){e[e.DBR_SYSTEM_EXCEPTION=1]="DBR_SYSTEM_EXCEPTION",e[e.DBR_SUCCESS=0]="DBR_SUCCESS",e[e.DBR_UNKNOWN=-1e4]="DBR_UNKNOWN",e[e.DBR_NO_MEMORY=-10001]="DBR_NO_MEMORY",e[e.DBR_NULL_REFERENCE=-10002]="DBR_NULL_REFERENCE",e[e.DBR_LICENSE_INVALID=-10003]="DBR_LICENSE_INVALID",e[e.DBR_LICENSE_EXPIRED=-10004]="DBR_LICENSE_EXPIRED",e[e.DBR_FILE_NOT_FOUND=-10005]="DBR_FILE_NOT_FOUND",e[e.DBR_FILETYPE_NOT_SUPPORTED=-10006]="DBR_FILETYPE_NOT_SUPPORTED",e[e.DBR_BPP_NOT_SUPPORTED=-10007]="DBR_BPP_NOT_SUPPORTED",e[e.DBR_INDEX_INVALID=-10008]="DBR_INDEX_INVALID",e[e.DBR_BARCODE_FORMAT_INVALID=-10009]="DBR_BARCODE_FORMAT_INVALID",e[e.DBR_CUSTOM_REGION_INVALID=-10010]="DBR_CUSTOM_REGION_INVALID",e[e.DBR_MAX_BARCODE_NUMBER_INVALID=-10011]="DBR_MAX_BARCODE_NUMBER_INVALID",e[e.DBR_IMAGE_READ_FAILED=-10012]="DBR_IMAGE_READ_FAILED",e[e.DBR_TIFF_READ_FAILED=-10013]="DBR_TIFF_READ_FAILED",e[e.DBR_QR_LICENSE_INVALID=-10016]="DBR_QR_LICENSE_INVALID",e[e.DBR_1D_LICENSE_INVALID=-10017]="DBR_1D_LICENSE_INVALID",e[e.DBR_DIB_BUFFER_INVALID=-10018]="DBR_DIB_BUFFER_INVALID",e[e.DBR_PDF417_LICENSE_INVALID=-10019]="DBR_PDF417_LICENSE_INVALID",e[e.DBR_DATAMATRIX_LICENSE_INVALID=-10020]="DBR_DATAMATRIX_LICENSE_INVALID",e[e.DBR_PDF_READ_FAILED=-10021]="DBR_PDF_READ_FAILED",e[e.DBR_PDF_DLL_MISSING=-10022]="DBR_PDF_DLL_MISSING",e[e.DBR_PAGE_NUMBER_INVALID=-10023]="DBR_PAGE_NUMBER_INVALID",e[e.DBR_CUSTOM_SIZE_INVALID=-10024]="DBR_CUSTOM_SIZE_INVALID",e[e.DBR_CUSTOM_MODULESIZE_INVALID=-10025]="DBR_CUSTOM_MODULESIZE_INVALID",e[e.DBR_RECOGNITION_TIMEOUT=-10026]="DBR_RECOGNITION_TIMEOUT",e[e.DBR_JSON_PARSE_FAILED=-10030]="DBR_JSON_PARSE_FAILED",e[e.DBR_JSON_TYPE_INVALID=-10031]="DBR_JSON_TYPE_INVALID",e[e.DBR_JSON_KEY_INVALID=-10032]="DBR_JSON_KEY_INVALID",e[e.DBR_JSON_VALUE_INVALID=-10033]="DBR_JSON_VALUE_INVALID",e[e.DBR_JSON_NAME_KEY_MISSING=-10034]="DBR_JSON_NAME_KEY_MISSING",e[e.DBR_JSON_NAME_VALUE_DUPLICATED=-10035]="DBR_JSON_NAME_VALUE_DUPLICATED",e[e.DBR_TEMPLATE_NAME_INVALID=-10036]="DBR_TEMPLATE_NAME_INVALID",e[e.DBR_JSON_NAME_REFERENCE_INVALID=-10037]="DBR_JSON_NAME_REFERENCE_INVALID",e[e.DBR_PARAMETER_VALUE_INVALID=-10038]="DBR_PARAMETER_VALUE_INVALID",e[e.DBR_DOMAIN_NOT_MATCHED=-10039]="DBR_DOMAIN_NOT_MATCHED",e[e.DBR_RESERVEDINFO_NOT_MATCHED=-10040]="DBR_RESERVEDINFO_NOT_MATCHED",e[e.DBR_AZTEC_LICENSE_INVALID=-10041]="DBR_AZTEC_LICENSE_INVALID",e[e.DBR_LICENSE_DLL_MISSING=-10042]="DBR_LICENSE_DLL_MISSING",e[e.DBR_LICENSEKEY_NOT_MATCHED=-10043]="DBR_LICENSEKEY_NOT_MATCHED",e[e.DBR_REQUESTED_FAILED=-10044]="DBR_REQUESTED_FAILED",e[e.DBR_LICENSE_INIT_FAILED=-10045]="DBR_LICENSE_INIT_FAILED",e[e.DBR_PATCHCODE_LICENSE_INVALID=-10046]="DBR_PATCHCODE_LICENSE_INVALID",e[e.DBR_POSTALCODE_LICENSE_INVALID=-10047]="DBR_POSTALCODE_LICENSE_INVALID",e[e.DBR_DPM_LICENSE_INVALID=-10048]="DBR_DPM_LICENSE_INVALID",e[e.DBR_FRAME_DECODING_THREAD_EXISTS=-10049]="DBR_FRAME_DECODING_THREAD_EXISTS",e[e.DBR_STOP_DECODING_THREAD_FAILED=-10050]="DBR_STOP_DECODING_THREAD_FAILED",e[e.DBR_SET_MODE_ARGUMENT_ERROR=-10051]="DBR_SET_MODE_ARGUMENT_ERROR",e[e.DBR_LICENSE_CONTENT_INVALID=-10052]="DBR_LICENSE_CONTENT_INVALID",e[e.DBR_LICENSE_KEY_INVALID=-10053]="DBR_LICENSE_KEY_INVALID",e[e.DBR_LICENSE_DEVICE_RUNS_OUT=-10054]="DBR_LICENSE_DEVICE_RUNS_OUT",e[e.DBR_GET_MODE_ARGUMENT_ERROR=-10055]="DBR_GET_MODE_ARGUMENT_ERROR",e[e.DBR_IRT_LICENSE_INVALID=-10056]="DBR_IRT_LICENSE_INVALID",e[e.DBR_MAXICODE_LICENSE_INVALID=-10057]="DBR_MAXICODE_LICENSE_INVALID",e[e.DBR_GS1_DATABAR_LICENSE_INVALID=-10058]="DBR_GS1_DATABAR_LICENSE_INVALID",e[e.DBR_GS1_COMPOSITE_LICENSE_INVALID=-10059]="DBR_GS1_COMPOSITE_LICENSE_INVALID",e[e.DBR_DOTCODE_LICENSE_INVALID=-10061]="DBR_DOTCODE_LICENSE_INVALID",e[e.DMERR_NO_LICENSE=-2e4]="DMERR_NO_LICENSE",e[e.DMERR_LICENSE_SYNC_FAILED=-20003]="DMERR_LICENSE_SYNC_FAILED",e[e.DMERR_TRIAL_LICENSE=-20010]="DMERR_TRIAL_LICENSE",e[e.DMERR_FAILED_TO_REACH_LTS=-20200]="DMERR_FAILED_TO_REACH_LTS"}(A||(A={})),function(e){e[e.IMRDT_IMAGE=1]="IMRDT_IMAGE",e[e.IMRDT_CONTOUR=2]="IMRDT_CONTOUR",e[e.IMRDT_LINESEGMENT=4]="IMRDT_LINESEGMENT",e[e.IMRDT_LOCALIZATIONRESULT=8]="IMRDT_LOCALIZATIONRESULT",e[e.IMRDT_REGIONOFINTEREST=16]="IMRDT_REGIONOFINTEREST",e[e.IMRDT_QUADRILATERAL=32]="IMRDT_QUADRILATERAL"}(S||(S={})),function(e){e[e.BF_ALL=-31457281]="BF_ALL",e[e.BF_ONED=1050623]="BF_ONED",e[e.BF_GS1_DATABAR=260096]="BF_GS1_DATABAR",e[e.BF_CODE_39=1]="BF_CODE_39",e[e.BF_CODE_128=2]="BF_CODE_128",e[e.BF_CODE_93=4]="BF_CODE_93",e[e.BF_CODABAR=8]="BF_CODABAR",e[e.BF_ITF=16]="BF_ITF",e[e.BF_EAN_13=32]="BF_EAN_13",e[e.BF_EAN_8=64]="BF_EAN_8",e[e.BF_UPC_A=128]="BF_UPC_A",e[e.BF_UPC_E=256]="BF_UPC_E",e[e.BF_INDUSTRIAL_25=512]="BF_INDUSTRIAL_25",e[e.BF_CODE_39_EXTENDED=1024]="BF_CODE_39_EXTENDED",e[e.BF_GS1_DATABAR_OMNIDIRECTIONAL=2048]="BF_GS1_DATABAR_OMNIDIRECTIONAL",e[e.BF_GS1_DATABAR_TRUNCATED=4096]="BF_GS1_DATABAR_TRUNCATED",e[e.BF_GS1_DATABAR_STACKED=8192]="BF_GS1_DATABAR_STACKED",e[e.BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL=16384]="BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL",e[e.BF_GS1_DATABAR_EXPANDED=32768]="BF_GS1_DATABAR_EXPANDED",e[e.BF_GS1_DATABAR_EXPANDED_STACKED=65536]="BF_GS1_DATABAR_EXPANDED_STACKED",e[e.BF_GS1_DATABAR_LIMITED=131072]="BF_GS1_DATABAR_LIMITED",e[e.BF_PATCHCODE=262144]="BF_PATCHCODE",e[e.BF_PDF417=33554432]="BF_PDF417",e[e.BF_QR_CODE=67108864]="BF_QR_CODE",e[e.BF_DATAMATRIX=134217728]="BF_DATAMATRIX",e[e.BF_AZTEC=268435456]="BF_AZTEC",e[e.BF_MAXICODE=536870912]="BF_MAXICODE",e[e.BF_MICRO_QR=1073741824]="BF_MICRO_QR",e[e.BF_MICRO_PDF417=524288]="BF_MICRO_PDF417",e[e.BF_GS1_COMPOSITE=-2147483648]="BF_GS1_COMPOSITE",e[e.BF_MSI_CODE=1048576]="BF_MSI_CODE",e[e.BF_NULL=0]="BF_NULL"}(b||(b={})),"object"==typeof n.g&&n.g.process&&n.g.process.release&&n.g.process.release.name;var D="undefined"==typeof self,C=D?{}:self,k=function(){function e(){(0,i.Z)(this,e),this._canvasMaxWH="iPhone"==e.browserInfo.OS||"Android"==e.browserInfo.OS?2048:4096,this._instanceID=void 0,this.bSaveOriCanvas=!1,this.oriCanvas=null,this.bFilterRegionInJs=!0,this._region=null,this._timeStartDecode=null,this._timeEnterInnerDBR=null,this._timeGetMessage=null,this._bUseWebgl=!0,this.decodeRecords={},this.bDestroyed=!1,this._lastErrorCode=0,this._lastErrorString="",this._lastInnerDecodeDuration=0}return(0,s.Z)(e,[{key:"ifSaveOriginalImageInACanvas",get:function(){return this.bSaveOriCanvas},set:function(e){this.bSaveOriCanvas=e}},{key:"getOriginalImageInACanvas",value:function(){return this.oriCanvas}},{key:"region",get:function(){return this._region},set:function(e){this._region=e}},{key:"isContextDestroyed",value:function(){return this.bDestroyed}},{key:"lastErrorCode",get:function(){return this._lastErrorCode}},{key:"lastErrorString",get:function(){return this._lastErrorString}},{key:"decode",value:function(t){return T(this,void 0,void 0,u().mark((function n(){var r;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e._onLog&&e._onLog("decode(source: any)"),e._onLog&&(this._timeStartDecode=Date.now()),r={},!this.region||this.region instanceof Array||(r.region=JSON.parse(JSON.stringify(this.region))),!(t instanceof Blob)){n.next=9;break}return n.next=6,this._decode_Blob(t,r);case 6:n.t0=n.sent,n.next=61;break;case 9:if(!(t instanceof ArrayBuffer)){n.next=15;break}return n.next=12,this._decode_ArrayBuffer(t,r);case 12:n.t1=n.sent,n.next=60;break;case 15:if(!(t instanceof Uint8Array||t instanceof Uint8ClampedArray)){n.next=21;break}return n.next=18,this._decode_Uint8Array(t,r);case 18:n.t2=n.sent,n.next=59;break;case 21:if(!(t instanceof HTMLImageElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap)){n.next=27;break}return n.next=24,this._decode_Image(t,r);case 24:n.t3=n.sent,n.next=58;break;case 27:if(!(t instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)){n.next=33;break}return n.next=30,this._decode_Canvas(t,r);case 30:n.t4=n.sent,n.next=57;break;case 33:if(!(t instanceof HTMLVideoElement)){n.next=39;break}return n.next=36,this._decode_Video(t,r);case 36:n.t5=n.sent,n.next=56;break;case 39:if("string"!=typeof t){n.next=52;break}if("data:image/"!=t.substring(0,11)){n.next=46;break}return n.next=43,this._decode_Base64(t,r);case 43:n.t7=n.sent,n.next=49;break;case 46:return n.next=48,this._decode_Url(t,r);case 48:n.t7=n.sent;case 49:n.t6=n.t7,n.next=55;break;case 52:return n.next=54,Promise.reject(TypeError("'_decode(source, config)': Type of 'source' should be 'Blob', 'ArrayBuffer', 'Uint8Array', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement', 'String(base64 with image mime)' or 'String(url)'."));case 54:n.t6=n.sent;case 55:n.t5=n.t6;case 56:n.t4=n.t5;case 57:n.t3=n.t4;case 58:n.t2=n.t3;case 59:n.t1=n.t2;case 60:n.t0=n.t1;case 61:return n.abrupt("return",n.t0);case 62:case"end":return n.stop()}}),n,this)})))}},{key:"decodeBase64String",value:function(e){return T(this,void 0,void 0,u().mark((function t(){var n;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={},t.abrupt("return",(!this.region||this.region instanceof Array||(n.region=JSON.parse(JSON.stringify(this.region))),this._decode_Base64(e,n)));case 2:case"end":return t.stop()}}),t,this)})))}},{key:"decodeUrl",value:function(e){return T(this,void 0,void 0,u().mark((function t(){var n;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={},t.abrupt("return",(!this.region||this.region instanceof Array||(n.region=JSON.parse(JSON.stringify(this.region))),this._decode_Url(e,n)));case 2:case"end":return t.stop()}}),t,this)})))}},{key:"_decodeBuffer_Uint8Array",value:function(t,n,r,i,s,a){return T(this,void 0,void 0,u().mark((function o(){var c=this;return u().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,new Promise((function(o,u){var d=e._nextTaskID++;e._taskCallbackMap.set(d,(function(t){if(t.success){var n,r=e._onLog?Date.now():0;e._onLog&&e._onLog("worker return result: "+r),c._lastInnerDecodeDuration=t.duration;try{n=c._handleRetJsonString(t.decodeReturn)}catch(t){return u(t)}if(e._onLog){var i=Date.now();e._onLog("DBR time get result: "+r),e._onLog("Handle image cost: "+(c._timeEnterInnerDBR-c._timeStartDecode)),e._onLog("DBR worker decode image cost: "+(r-c._timeEnterInnerDBR)),e._onLog("DBR worker handle results: "+(i-r)),e._onLog("Total decode image cost: "+(i-c._timeStartDecode))}return o(n)}var s=new Error(t.message);return s.stack=t.stack+"\n"+s.stack,u(s)})),c._timeEnterInnerDBR=Date.now(),e._onLog&&e._onLog("Send buffer to worker:"+c._timeEnterInnerDBR),e._dbrWorker.postMessage({type:"decodeBuffer",id:d,instanceID:c._instanceID,body:{buffer:t,width:n,height:r,stride:i,format:s,config:a}},[t.buffer]),e._onLog&&a&&a._timeEndGettingFrame&&e._onLog("decode image delay: "+(c._timeEnterInnerDBR-a._timeEndGettingFrame))}));case 2:return o.abrupt("return",o.sent);case 3:case"end":return o.stop()}}),o)})))}},{key:"_decodeBuffer_Blob",value:function(t,n,r,i,s,a){return T(this,void 0,void 0,u().mark((function o(){var c;return u().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(e._onLog&&e._onLog("_decodeBuffer_Blob(buffer,width,height,stride,format)"),!t.arrayBuffer){o.next=7;break}return o.next=4,t.arrayBuffer();case 4:o.t0=o.sent,o.next=10;break;case 7:return o.next=9,new Promise((function(e,n){var r=new FileReader;r.readAsArrayBuffer(t),r.onload=function(){e(r.result)},r.onerror=function(){n(r.error)}}));case 9:o.t0=o.sent;case 10:return c=o.t0,o.next=13,this._decodeBuffer_Uint8Array(new Uint8Array(c),n,r,i,s,a);case 13:return o.abrupt("return",o.sent);case 14:case"end":return o.stop()}}),o,this)})))}},{key:"decodeBuffer",value:function(t,n,r,i,s,a){return T(this,void 0,void 0,u().mark((function o(){var c;return u().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(e._onLog&&e._onLog("decodeBuffer(buffer,width,height,stride,format)"),e._onLog&&(this._timeStartDecode=Date.now()),!(t instanceof Uint8Array||t instanceof Uint8ClampedArray)){o.next=8;break}return o.next=5,this._decodeBuffer_Uint8Array(t,n,r,i,s,a);case 5:c=o.sent,o.next=19;break;case 8:if(!(t instanceof ArrayBuffer)){o.next=14;break}return o.next=11,this._decodeBuffer_Uint8Array(new Uint8Array(t),n,r,i,s,a);case 11:c=o.sent,o.next=19;break;case 14:if(o.t0=t instanceof Blob,!o.t0){o.next=19;break}return o.next=18,this._decodeBuffer_Blob(t,n,r,i,s,a);case 18:c=o.sent;case 19:return o.abrupt("return",c);case 20:case"end":return o.stop()}}),o,this)})))}},{key:"_decodeFileInMemory_Uint8Array",value:function(t){return T(this,void 0,void 0,u().mark((function n(){var r=this;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,new Promise((function(n,i){var s=e._nextTaskID++;e._taskCallbackMap.set(s,(function(e){if(e.success){var t;r._lastInnerDecodeDuration=e.duration;try{t=r._handleRetJsonString(e.decodeReturn)}catch(e){return i(e)}return n(t)}var s=new Error(e.message);return s.stack=e.stack+"\n"+s.stack,i(s)})),e._dbrWorker.postMessage({type:"decodeFileInMemory",id:s,instanceID:r._instanceID,body:{bytes:t}})}));case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n)})))}},{key:"getRuntimeSettings",value:function(){return T(this,void 0,void 0,u().mark((function t(){var n=this;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t,r){var i=e._nextTaskID++;e._taskCallbackMap.set(i,(function(e){if(e.success){var i=JSON.parse(e.results);return null!=n.userDefinedRegion&&(i.region=JSON.parse(JSON.stringify(n.userDefinedRegion))),t(i)}var s=new Error(e.message);return s.stack=e.stack+"\n"+s.stack,r(s)})),e._dbrWorker.postMessage({type:"getRuntimeSettings",id:i,instanceID:n._instanceID})}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))}},{key:"updateRuntimeSettings",value:function(t){return T(this,void 0,void 0,u().mark((function n(){var r,i,s,a,o,c,d=this;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("string"!=typeof t){n.next=52;break}if("speed"!=t){n.next=18;break}return n.next=4,this.getRuntimeSettings();case 4:return i=n.sent,n.next=7,this.resetRuntimeSettings();case 7:return n.next=9,this.getRuntimeSettings();case 9:(r=n.sent).barcodeFormatIds=i.barcodeFormatIds,r.barcodeFormatIds_2=i.barcodeFormatIds_2,r.region=i.region,r.deblurLevel=3,r.expectedBarcodesCount=0,r.localizationModes=[2,0,0,0,0,0,0,0],n.next=50;break;case 18:if("balance"!=t){n.next=35;break}return n.next=21,this.getRuntimeSettings();case 21:return s=n.sent,n.next=24,this.resetRuntimeSettings();case 24:return n.next=26,this.getRuntimeSettings();case 26:(r=n.sent).barcodeFormatIds=s.barcodeFormatIds,r.barcodeFormatIds_2=s.barcodeFormatIds_2,r.region=s.region,r.deblurLevel=5,r.expectedBarcodesCount=512,r.localizationModes=[2,16,0,0,0,0,0,0],n.next=50;break;case 35:if("coverage"!=t){n.next=49;break}return n.next=38,this.getRuntimeSettings();case 38:return a=n.sent,n.next=41,this.resetRuntimeSettings();case 41:return n.next=43,this.getRuntimeSettings();case 43:(r=n.sent).barcodeFormatIds=a.barcodeFormatIds,r.barcodeFormatIds_2=a.barcodeFormatIds_2,r.region=a.region,n.next=50;break;case 49:r=JSON.parse(t);case 50:n.next=55;break;case 52:if("object"==typeof t){n.next=54;break}throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");case 54:(r=JSON.parse(JSON.stringify(t))).region instanceof Array&&[(o=r.region).regionLeft,o.regionTop,o.regionLeft,o.regionBottom,o.regionMeasuredByPercentage].some((function(e){return void 0!==e}))&&(r.region={regionLeft:o.regionLeft||0,regionTop:o.regionTop||0,regionRight:o.regionRight||0,regionBottom:o.regionBottom||0,regionMeasuredByPercentage:o.regionMeasuredByPercentage||0});case 55:if(e._bUseFullFeature){n.next=60;break}if(0==(r.barcodeFormatIds&~(b.BF_ONED|b.BF_QR_CODE|b.BF_PDF417|b.BF_DATAMATRIX))&&0==r.barcodeFormatIds_2){n.next=58;break}throw Error("Some of the specified barcode formats are not supported in the compact version. Please try the full-featured version.");case 58:if(0==r.intermediateResultTypes){n.next=60;break}throw Error("Intermediate results is not supported in the compact version. Please try the full-featured version.");case 60:if(!this.bFilterRegionInJs){n.next=67;break}if(!((c=r.region)instanceof Array)){n.next=64;break}throw Error("The `region` of type `Array` is only allowed in `BarcodeScanner`.");case 64:this.userDefinedRegion=JSON.parse(JSON.stringify(c)),(c.regionLeft||c.regionTop||c.regionRight||c.regionBottom||c.regionMeasuredByPercentage)&&(c.regionLeft||c.regionTop||100!=c.regionRight||100!=c.regionBottom||!c.regionMeasuredByPercentage)?this.region=c:this.region=null,r.region={regionLeft:0,regionTop:0,regionRight:0,regionBottom:0,regionMeasuredByPercentage:0},n.next=68;break;case 67:this.userDefinedRegion=null,this.region=null;case 68:return n.next=70,new Promise((function(t,n){var i=e._nextTaskID++;e._taskCallbackMap.set(i,(function(e){if(e.success){try{d._handleRetJsonString(e.updateReturn)}catch(t){n(t)}return t()}var r=new Error(e.message);return r.stack=e.stack+"\n"+r.stack,n(r)})),e._dbrWorker.postMessage({type:"updateRuntimeSettings",id:i,instanceID:d._instanceID,body:{settings:JSON.stringify(r)}})}));case 70:return n.abrupt("return",n.sent);case 71:case"end":return n.stop()}}),n,this)})))}},{key:"resetRuntimeSettings",value:function(){return T(this,void 0,void 0,u().mark((function t(){var n=this;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.userDefinedRegion=null,this.region=null,t.next=4,new Promise((function(t,r){var i=e._nextTaskID++;e._taskCallbackMap.set(i,(function(e){if(e.success)return t();var n=new Error(e.message);return n.stack=e.stack+"\n"+n.stack,r(n)})),e._dbrWorker.postMessage({type:"resetRuntimeSettings",id:i,instanceID:n._instanceID})}));case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"outputSettingsToString",value:function(){return T(this,void 0,void 0,u().mark((function t(){var n=this;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e._bUseFullFeature){t.next=2;break}throw Error("outputSettingsToString() is not supported in the compact version. Please try the full-featured version.");case 2:return t.next=4,new Promise((function(t,r){var i=e._nextTaskID++;e._taskCallbackMap.set(i,(function(e){if(e.success)return t(e.results);var n=new Error(e.message);return n.stack=e.stack+"\n"+n.stack,r(n)})),e._dbrWorker.postMessage({type:"outputSettingsToString",id:i,instanceID:n._instanceID})}));case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})))}},{key:"initRuntimeSettingsWithString",value:function(t){return T(this,void 0,void 0,u().mark((function n(){var r=this;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e._bUseFullFeature){n.next=2;break}throw Error("initRuntimeSettingsWithString() is not supported in the compact version. Please try the full-featured version.");case 2:if("string"!=typeof t){n.next=6;break}t=t,n.next=9;break;case 6:if("object"==typeof t){n.next=8;break}throw TypeError("'initRuntimeSettingstWithString(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");case 8:t=JSON.stringify(t);case 9:return n.next=11,new Promise((function(n,i){var s=e._nextTaskID++;e._taskCallbackMap.set(s,(function(e){if(e.success){try{r._handleRetJsonString(e.initReturn)}catch(e){i(e)}return n()}var t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,i(t)})),e._dbrWorker.postMessage({type:"initRuntimeSettingsWithString",id:s,instanceID:r._instanceID,body:{settings:t}})}));case 11:return n.abrupt("return",n.sent);case 12:case"end":return n.stop()}}),n)})))}},{key:"_decode_Blob",value:function(t,n){return T(this,void 0,void 0,u().mark((function r(){var i,s,a;return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e._onLog&&e._onLog("_decode_Blob(blob: Blob)"),i=null,s=null,"undefined"==typeof createImageBitmap){r.next=11;break}return r.prev=3,r.next=6,createImageBitmap(t);case 6:i=r.sent,r.next=11;break;case 9:r.prev=9,r.t0=r.catch(3);case 11:if(r.t1=i,r.t1){r.next=16;break}return r.next=15,function(e){return new Promise((function(t,n){var r=URL.createObjectURL(e),i=new Image;i.dbrObjUrl=r,i.src=r,i.onload=function(){t(i)},i.onerror=function(e){n(new Error("Can't convert blob to image : "+(e instanceof Event?e.type:e)))}}))}(t);case 15:s=r.sent;case 16:return r.next=18,this._decode_Image(i||s,n);case 18:return a=r.sent,r.abrupt("return",(i&&i.close(),a));case 20:case"end":return r.stop()}}),r,this,[[3,9]])})))}},{key:"_decode_ArrayBuffer",value:function(e,t){return T(this,void 0,void 0,u().mark((function n(){return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this._decode_Blob(new Blob([e]),t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n,this)})))}},{key:"_decode_Uint8Array",value:function(e,t){return T(this,void 0,void 0,u().mark((function n(){return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this._decode_Blob(new Blob([e]),t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n,this)})))}},{key:"_decode_Image",value:function(t,n){return T(this,void 0,void 0,u().mark((function r(){var i,s,a,o,c,d,l,_,h,f,g,v,p,m,R,E;return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e._onLog&&e._onLog("_decode_Image(image: HTMLImageElement|ImageBitmap)"),n=n||{},c=t instanceof HTMLImageElement?t.naturalWidth:t.width,d=t instanceof HTMLImageElement?t.naturalHeight:t.height,(l=n.region)?(l.regionMeasuredByPercentage?(_=l.regionLeft*c/100,h=l.regionTop*d/100,f=l.regionRight*c/100,g=l.regionBottom*d/100):(_=l.regionLeft,h=l.regionTop,f=l.regionRight,g=l.regionBottom),i=_,s=h,c=Math.round(f-_),d=Math.round(g-h)):(i=0,s=0),(v=Math.max(c,d))>this._canvasMaxWH?(p=this._canvasMaxWH/v,c>d?(a=this._canvasMaxWH,o=Math.round(d*p)):(a=Math.round(c*p),o=this._canvasMaxWH)):(a=c,o=d),!this.bSaveOriCanvas&&C.OffscreenCanvas?m=new OffscreenCanvas(a,o):((m=document.createElement("canvas")).width=a,m.height=o),m.getContext("2d").drawImage(t,i,s,c,d,0,0,a,o),t.dbrObjUrl&&URL.revokeObjectURL(t.dbrObjUrl),l?delete(R=JSON.parse(JSON.stringify(n))).region:R=n,r.next=8,this._decode_Canvas(m,R);case 8:return E=r.sent,r.abrupt("return",(e.fixResultLocationWhenFilterRegionInJs(l,E,i,s,c,d,a,o),E));case 10:case"end":return r.stop()}}),r,this)})))}},{key:"_decode_Canvas",value:function(t,n){return T(this,void 0,void 0,u().mark((function r(){var i;return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e._onLog&&e._onLog("_decode_Canvas(canvas:HTMLCanvasElement)"),!t.crossOrigin||"anonymous"==t.crossOrigin){r.next=2;break}throw"cors";case 2:return(this.bSaveOriCanvas||this.singleFrameMode)&&(this.oriCanvas=t),i=(t.dbrCtx2d||t.getContext("2d")).getImageData(0,0,t.width,t.height).data,r.next=6,this._decodeBuffer_Uint8Array(i,t.width,t.height,4*t.width,I.IPF_ABGR_8888,n);case 6:return r.abrupt("return",r.sent);case 7:case"end":return r.stop()}}),r,this)})))}},{key:"_decode_Video",value:function(t,n){return T(this,void 0,void 0,u().mark((function r(){var i,s,a,o,c,d,l,_,h,f,g,v,p,m,R;return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e._onLog&&e._onLog("_decode_Video(video)"),t instanceof HTMLVideoElement){r.next=2;break}throw TypeError("'_decode_Video(video [, config] )': Type of 'video' should be 'HTMLVideoElement'.");case 2:if(!t.crossOrigin||"anonymous"==t.crossOrigin){r.next=4;break}throw"cors";case 4:return n=n||{},c=t.videoWidth,d=t.videoHeight,(l=n.region)?(l.regionMeasuredByPercentage?(_=l.regionLeft*c/100,h=l.regionTop*d/100,f=l.regionRight*c/100,g=l.regionBottom*d/100):(_=l.regionLeft,h=l.regionTop,f=l.regionRight,g=l.regionBottom),i=_,s=h,c=Math.round(f-_),d=Math.round(g-h)):(i=0,s=0),(v=Math.max(c,d))>this._canvasMaxWH?(p=this._canvasMaxWH/v,c>d?(a=this._canvasMaxWH,o=Math.round(d*p)):(a=Math.round(c*p),o=this._canvasMaxWH)):(a=c,o=d),m=null,!this.bSaveOriCanvas&&C.OffscreenCanvas?m=new OffscreenCanvas(a,o):((m=document.createElement("canvas")).width=a,m.height=o),(m.dbrCtx2d=m.getContext("2d")).drawImage(t,i,s,c,d,0,0,a,o),l?delete JSON.parse(JSON.stringify(n)).region:n,r.next=14,this._decode_Canvas(m,n);case 14:return R=r.sent,r.abrupt("return",(l&&e.fixResultLocationWhenFilterRegionInJs(l,R,i,s,c,d,a,o),R));case 16:case"end":return r.stop()}}),r,this)})))}},{key:"_decode_Base64",value:function(t,n){return T(this,void 0,void 0,u().mark((function r(){var i,s,a;return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e._onLog&&e._onLog("_decode_Base64(base64Str)"),"string"==typeof t){r.next=2;break}return r.abrupt("return",Promise.reject("'_decode_Base64(base64Str, config)': Type of 'base64Str' should be 'string'."));case 2:for("data:image/"==t.substring(0,11)&&(t=t.substring(t.indexOf(",")+1)),i=atob(t),s=i.length,a=new Uint8Array(s);s--;)a[s]=i.charCodeAt(s);return r.next=7,this._decode_Blob(new Blob([a]),n);case 7:return r.abrupt("return",r.sent);case 8:case"end":return r.stop()}}),r,this)})))}},{key:"_decode_Url",value:function(t,n){return T(this,void 0,void 0,u().mark((function r(){var i,s=this;return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e._onLog&&e._onLog("_decode_Url(url)"),"string"==typeof t){r.next=2;break}throw TypeError("'_decode_Url(url, config)': Type of 'url' should be 'string'.");case 2:return t=t,r.next=5,new Promise((function(e,n){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="blob",r.send(),r.onloadend=function(){return T(s,void 0,void 0,u().mark((function t(){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e(r.response);case 1:case"end":return t.stop()}}),t)})))},r.onerror=function(){n(new Error("Network Error: "+r.statusText))}}));case 5:return i=r.sent,r.next=8,this._decode_Blob(i,n);case 8:return r.abrupt("return",r.sent);case 9:case"end":return r.stop()}}),r,this)})))}},{key:"_decode_FilePath",value:function(t,n){return T(this,void 0,void 0,u().mark((function t(){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:throw e._onLog&&e._onLog("_decode_FilePath(path)"),Error("'_decode_FilePath(path, config)': The method is only supported in node environment.");case 1:case"end":return t.stop()}}),t)})))}},{key:"_handleRetJsonString",value:function(t){var n=A;if(t.textResults){for(var r=0;r<t.textResults.length;r++){var i=t.textResults[r];try{for(var s=i.barcodeText,a="",o=0;o<s.length;o++)a+=String.fromCharCode(s[o]);try{i.barcodeText=decodeURIComponent(escape(a))}catch(t){i.barcodeText=a}}catch(t){i.barcodeText=""}null!=i.exception&&function(){e._setWarnnedEx.has(i.exception)||(e._setWarnnedEx.add(i.exception),console.warn(i.exception));var t={};i.exception.split(";").forEach((function(e){var n=e.indexOf(":");t[e.substring(0,n)]=e.substring(n+1)})),i.exception=t}()}return t.decodeRecords?this.decodeRecords=t.decodeRecords:this.decodeRecords={},this._lastErrorCode=t.exception,this._lastErrorString=t.description,t.exception&&!e._setWarnnedEx.has(t.description)&&(e._setWarnnedEx.add(t.description),console.warn(t.description)),t.textResults}if(t.exception==n.DBR_SUCCESS)return t.data;throw e.BarcodeReaderException(t.exception,t.description)}},{key:"setModeArgument",value:function(t,n,r,i){return T(this,void 0,void 0,u().mark((function s(){var a=this;return u().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,new Promise((function(s,o){var c=e._nextTaskID++;e._taskCallbackMap.set(c,(function(e){if(e.success){try{a._handleRetJsonString(e.setReturn)}catch(e){return o(e)}return s()}var t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,o(t)})),e._dbrWorker.postMessage({type:"setModeArgument",id:c,instanceID:a._instanceID,body:{modeName:t,index:n,argumentName:r,argumentValue:i}})}));case 2:return s.abrupt("return",s.sent);case 3:case"end":return s.stop()}}),s)})))}},{key:"getModeArgument",value:function(t,n,r){return T(this,void 0,void 0,u().mark((function i(){var s=this;return u().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,new Promise((function(i,a){var o=e._nextTaskID++;e._taskCallbackMap.set(o,(function(e){if(e.success){var t;try{t=s._handleRetJsonString(e.getReturn)}catch(e){return a(e)}return i(t)}var n=new Error(e.message);return n.stack=e.stack+"\n"+n.stack,a(n)})),e._dbrWorker.postMessage({type:"getModeArgument",id:o,instanceID:s._instanceID,body:{modeName:t,index:n,argumentName:r}})}));case 2:return i.abrupt("return",i.sent);case 3:case"end":return i.stop()}}),i)})))}},{key:"getIntermediateResults",value:function(){return T(this,void 0,void 0,u().mark((function t(){var n=this;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t,r){var i=e._nextTaskID++;e._taskCallbackMap.set(i,(function(e){if(e.success)return t(e.results);var n=new Error(e.message);return n.stack=e.stack+"\n"+n.stack,r(n)})),e._dbrWorker.postMessage({type:"getIntermediateResults",id:i,instanceID:n._instanceID})}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))}},{key:"getIntermediateCanvas",value:function(){return T(this,void 0,void 0,u().mark((function t(){var n,r,i,s,a,o,c,d,l,_,h,f,g,p,m,R,E,A,b,y;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getIntermediateResults();case 2:n=t.sent,r=[],i=(0,v.Z)(n),t.prev=5,i.s();case 7:if((s=i.n()).done){t.next=52;break}if((a=s.value).dataType!=S.IMRDT_IMAGE){t.next=50;break}o=(0,v.Z)(a.results),t.prev=11,o.s();case 13:if((c=o.n()).done){t.next=42;break}d=c.value,l=d.bytes,_=void 0,t.t0=(e._onLog&&e._onLog(" "+l.length+" "+l.byteLength+" "+d.width+" "+d.height+" "+d.stride+" "+d.format),d.format),t.next=t.t0===I.IPF_ABGR_8888?20:t.t0===I.IPF_RGB_888?22:t.t0===I.IPF_GrayScaled?26:t.t0===I.IPF_Binary||t.t0===I.IPF_BinaryInverted?30:35;break;case 20:return _=new Uint8ClampedArray(l),t.abrupt("break",36);case 22:for(h=l.length/3,_=new Uint8ClampedArray(4*h),f=0;f<h;++f)_[4*f]=l[3*f+2],_[4*f+1]=l[3*f+1],_[4*f+2]=l[3*f],_[4*f+3]=255;return t.abrupt("break",36);case 26:for(g=l.length,_=new Uint8ClampedArray(4*g),p=0;p<g;p++)_[4*p]=_[4*p+1]=_[4*p+2]=l[p],_[4*p+3]=255;return t.abrupt("break",36);case 30:for(d.width=8*d.stride,d.height=l.length/d.stride,m=l.length,_=new Uint8ClampedArray(8*m*4),R=0;R<m;R++)for(E=l[R],A=0;A<8;++A)_[4*(8*R+A)]=_[4*(8*R+A)+1]=_[4*(8*R+A)+2]=(128&E)/128*255,_[4*(8*R+A)+3]=255,E<<=1;return t.abrupt("break",36);case 35:console.warn("unknow intermediate image",d);case 36:if(_){t.next=38;break}return t.abrupt("continue",40);case 38:b=new ImageData(_,d.width,d.height),(y=document.createElement("canvas")).width=d.width,y.height=d.height,y.getContext("2d").putImageData(b,0,0),r.push(y);case 40:t.next=13;break;case 42:t.next=47;break;case 44:t.prev=44,t.t1=t.catch(11),o.e(t.t1);case 47:return t.prev=47,o.f(),t.finish(47);case 50:t.next=7;break;case 52:t.next=57;break;case 54:t.prev=54,t.t2=t.catch(5),i.e(t.t2);case 57:return t.prev=57,i.f(),t.finish(57);case 60:return t.abrupt("return",r);case 61:case"end":return t.stop()}}),t,this,[[5,54,57,60],[11,44,47,50]])})))}},{key:"destroy",value:function(){return this.destroyContext()}},{key:"destroyContext",value:function(){var t=this;if(e._onLog&&e._onLog("destroyContext()"),!this.bDestroyed)return this.bDestroyed=!0,new Promise((function(n,r){var i=e._nextTaskID++;e._taskCallbackMap.set(i,(function(e){if(e.success)return n();var t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,r(t)})),e._dbrWorker.postMessage({type:"destroyContext",id:i,instanceID:t._instanceID})}))}}],[{key:"version",get:function(){return this._version}},{key:"license",get:function(){return this._license},set:function(t){if("unload"!=this._loadWasmStatus)throw new Error("`license` is not allowed to change after `createInstance` or `loadWasm` is called.");e._license=t}},{key:"productKeys",get:function(){return this._license},set:function(t){e.license=t}},{key:"handshakeCode",get:function(){return this._license},set:function(t){e.license=t}},{key:"organizationID",get:function(){return this._license},set:function(t){e.license=t}},{key:"sessionPassword",get:function(){return this._sessionPassword},set:function(t){if("unload"!=this._loadWasmStatus)throw new Error("`sessionPassword` is not allowed to change after `createInstance` or `loadWasm` is called.");e._sessionPassword=t}},{key:"detectEnvironment",value:function(){return T(this,void 0,void 0,u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t={wasm:"undefined"!=typeof WebAssembly&&("undefined"==typeof navigator||!(/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&/\(.+\s11_2_([2-6]).*\)/.test(navigator.userAgent))),worker:!("undefined"==typeof Worker),getUserMedia:!("undefined"==typeof navigator||!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia),camera:!1,browser:this.browserInfo.browser,version:this.browserInfo.version,OS:this.browserInfo.OS}).getUserMedia){e.next=11;break}return e.prev=2,e.next=5,navigator.mediaDevices.getUserMedia({video:!0});case 5:e.sent.getTracks().forEach((function(e){e.stop()})),t.camera=!0,e.next=11;break;case 9:e.prev=9,e.t0=e.catch(2);case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,this,[[2,9]])})))}},{key:"engineResourcePath",get:function(){return this._engineResourcePath},set:function(t){if("unload"!=this._loadWasmStatus)throw new Error("`engineResourcePath` is not allowed to change after `createInstance` or `loadWasm` is called.");if(null==t&&(t="./"),D)e._engineResourcePath=t;else{var n=document.createElement("a");n.href=t,e._engineResourcePath=n.href}this._engineResourcePath.endsWith("/")||(e._engineResourcePath+="/")}},{key:"licenseServer",get:function(){return this._licenseServer},set:function(t){if("unload"!=this._loadWasmStatus)throw new Error("`licenseServer` is not allowed to change after `createInstance` or `loadWasm` is called.");if(null==t)e._licenseServer=[];else{t instanceof Array||(t=[t]);for(var n=0;n<t.length;++n){if(!D){var r=document.createElement("a");r.href=t[n],t[n]=r.href}t[n].endsWith("/")||(t[n]+="/")}e._licenseServer=t}}},{key:"deviceFriendlyName",get:function(){return this._deviceFriendlyName},set:function(t){if("unload"!=this._loadWasmStatus)throw new Error("`deviceFriendlyName` is not allowed to change after `createInstance` or `loadWasm` is called.");e._deviceFriendlyName=t||""}},{key:"_bUseFullFeature",get:function(){return this.__bUseFullFeature},set:function(t){if("unload"!=this._loadWasmStatus)throw new Error("`_bUseFullFeature` is not allowed to change after `createInstance` or `loadWasm` is called.");e.__bUseFullFeature=t}},{key:"isLoaded",value:function(){return"loadSuccess"==this._loadWasmStatus}},{key:"lastErrorCode",get:function(){return this._lastErrorCode}},{key:"lastErrorString",get:function(){return this._lastErrorString}},{key:"loadWasm",value:function(){return T(this,void 0,void 0,u().mark((function t(){var n,r,i,s,a,o,c,d,l,_,h,f=this;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e._license,i=JSON.parse(JSON.stringify(e._licenseServer)),s=e._sessionPassword,a=null,o=null,c=0,r.startsWith("t")||r.startsWith("f")?c=0:0===r.length||r.startsWith("P")||r.startsWith("L")?c=1:(c=2,-1!=(d=r.indexOf(":"))&&(r=r.substring(d+1)),r.startsWith("DLS2")&&(l=r.substring(4),l=atob(l),(_=JSON.parse(l)).handshakeCode?r=_.handshakeCode:_.organizationID&&(r=_.organizationID),"number"==typeof r&&(r=JSON.stringify(r)),r||(r=""),0===i.length&&(h=[],_.mainServerURL&&(h[0]=_.mainServerURL),_.standbyServerURL&&(h[1]=_.standbyServerURL),e.licenseServer=h,i=e.licenseServer),!s&&_.sessionPassword&&(s=_.sessionPassword),_.chargeWay&&(o=_.chargeWay),_.limitedLicenseModules&&(a=_.limitedLicenseModules))),c&&(C.crypto||(n="Please upgrade your browser to support online key."),C.crypto.subtle||(n="Require https to use online key in this browser.")),!n){t.next=6;break}if(1===c){t.next=5;break}throw new Error(n);case 5:c=0,console.warn(n),e._lastErrorCode=A.DMERR_FAILED_TO_REACH_LTS,e._lastErrorString=n;case 6:return 1===c&&(r="",console.warn("Automatically apply for a public trial license.")),t.next=9,new Promise((function(t,n){return T(f,void 0,void 0,u().mark((function d(){var l,_=this;return u().wrap((function(d){for(;;)switch(d.prev=d.next){case 0:d.t0=e._loadWasmStatus,d.next="unload"===d.t0?3:"loading"===d.t0?14:"loadSuccess"===d.t0?16:"loadFail"===d.t0?18:19;break;case 3:if(e._loadWasmStatus="loading",l=e.engineResourcePath+e._workerName,d.t1=e.engineResourcePath.startsWith(location.origin),d.t1){d.next=10;break}return d.next=9,fetch(l).then((function(e){return e.blob()})).then((function(e){return URL.createObjectURL(e)}));case 9:l=d.sent;case 10:e._dbrWorker=new Worker(l),e._dbrWorker.onerror=function(t){e._loadWasmStatus="loadFail";var n=new Error(t.message);e._loadWasmErr=n;var r,i=(0,v.Z)(e._loadWasmCallbackArr);try{for(i.s();!(r=i.n()).done;){(0,r.value)(n)}}catch(s){i.e(s)}finally{i.f()}e._loadWasmCallbackArr=[]},e._dbrWorker.onmessage=function(t){return T(_,void 0,void 0,u().mark((function n(){var r,i,s,a,o,d,l,_,h;return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=t.data?t.data:t,n.t0=r.type,n.next="log"===n.t0?4:"load"===n.t0?6:"task"===n.t0?11:20;break;case 4:return e._onLog&&e._onLog(r.message),n.abrupt("break",21);case 6:if(r.message&&(r.message=r.message.replace("(https://www.dynamsoft.com/purchase-center/)","(https://www.dynamsoft.com/store/dynamsoft-barcode-reader/#javascript)")),i=!1,1===c&&(i=!0),r.success){e._loadWasmStatus="loadSuccess",e._version=r.version+"(JS "+e._jsVersion+"."+e._jsEditVersion+")",e._onLog&&e._onLog("load dbr worker success"),s=(0,v.Z)(e._loadWasmCallbackArr);try{for(s.s();!(a=s.n()).done;)(0,a.value)()}catch(u){s.e(u)}finally{s.f()}e._loadWasmCallbackArr=[],e._dbrWorker.onerror=null,r.message&&console.warn(r.message)}else{(o=new Error(r.message)).stack=r.stack+"\n"+o.stack,e._loadWasmStatus="loadFail",e._loadWasmErr=o,d=(0,v.Z)(e._loadWasmCallbackArr);try{for(d.s();!(l=d.n()).done;)(0,l.value)(o)}catch(u){d.e(u)}finally{d.f()}e._loadWasmCallbackArr=[],i||111==r.ltsErrorCode&&-1!=r.message.toLowerCase().indexOf("trial license")&&(i=!0)}return i&&e.showDialog(r.success?"warn":"error",r.message),n.abrupt("break",21);case 11:_=r.id,h=r.body,n.prev=12,e._taskCallbackMap.get(_)(h),e._taskCallbackMap.delete(_),n.next=19;break;case 16:throw n.prev=16,n.t1=n.catch(12),e._taskCallbackMap.delete(_),n.t1;case 19:return n.abrupt("break",21);case 20:e._onLog&&e._onLog(t);case 21:case"end":return n.stop()}}),n,null,[[12,16]])})))},e._dbrWorker.postMessage({type:"loadWasm",bd:e._bWasmDebug,engineResourcePath:e.engineResourcePath,version:e._jsVersion,brtk:!!c,bptk:1===c,lcs:r,dm:location.origin.startsWith("http")?location.origin:"https://localhost",bUseFullFeature:e._bUseFullFeature,browserInfo:e.browserInfo,deviceFriendlyName:e.deviceFriendlyName,ls:i,sp:s,lm:a,cw:o});case 14:return e._loadWasmCallbackArr.push((function(e){e?n(e):t()})),d.abrupt("break",19);case 16:return t(),d.abrupt("break",19);case 18:n(e._loadWasmErr);case 19:case"end":return d.stop()}}),d)})))}));case 9:return t.abrupt("return",t.sent);case 10:case"end":return t.stop()}}),t)})))}},{key:"showDialog",value:function(t,n){return T(this,void 0,void 0,u().mark((function r(){return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e._bNeverShowDialog){r.next=8;break}return r.prev=1,r.delegateYield(u().mark((function r(){var i,s,a,o,c,d,l,_,h,f,g,p,m,R,E,I,A,S,b,y,T,D,C,k;return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,fetch(e.engineResourcePath+"dls.license.dialog.html");case 2:if((i=r.sent).ok){r.next=5;break}throw Error("Get license dialog fail. Network Error: "+i.statusText);case 5:return r.next=7,i.text();case 7:if((s=r.sent).trim().startsWith("<")){r.next=10;break}throw Error("Get license dialog fail. Can't get valid HTMLElement.");case 10:for((a=document.createElement("div")).innerHTML=s,o=[],c=0;c<a.childElementCount;++c)(d=a.children[c])instanceof HTMLStyleElement&&(o.push(d),document.head.append(d));(l=1==a.childElementCount?a.children[0]:a).remove(),m=[l],R=l.children,E=(0,v.Z)(R);try{for(E.s();!(I=E.n()).done;)A=I.value,m.push(A)}catch(u){E.e(u)}finally{E.f()}for(S=0;S<m.length;++S){b=(0,v.Z)(m[S].children);try{for(b.s();!(y=b.n()).done;)T=y.value,m.push(T)}catch(u){b.e(u)}finally{b.f()}}for(D=function(){var e=k[C];if(!_&&e.classList.contains("dls-license-mask"))_=e,e.addEventListener("click",(function(t){if(e==t.target){l.remove();var n,r=(0,v.Z)(o);try{for(r.s();!(n=r.n()).done;){n.value.remove()}}catch(u){r.e(u)}finally{r.f()}}}));else if(!h&&e.classList.contains("dls-license-icon-close"))h=e,e.addEventListener("click",(function(){l.remove();var e,t=(0,v.Z)(o);try{for(t.s();!(e=t.n()).done;){e.value.remove()}}catch(u){t.e(u)}finally{t.f()}}));else if(!f&&e.classList.contains("dls-license-icon-error"))f=e,"error"!=t&&e.remove();else if(!g&&e.classList.contains("dls-license-icon-warn"))g=e,"warn"!=t&&e.remove();else if(!p&&e.classList.contains("dls-license-msg-content")){p=e;for(var r=n;r;){var i=r.indexOf("["),s=r.indexOf("]",i),a=r.indexOf("(",s),c=r.indexOf(")",a);if(-1==i||-1==s||-1==a||-1==c){e.appendChild(new Text(r));break}i>0&&e.appendChild(new Text(r.substring(0,i)));var d=document.createElement("a"),m=r.substring(i+1,s);d.innerText=m;var R=r.substring(a+1,c);d.setAttribute("href",R),d.setAttribute("target","_blank"),e.appendChild(d),r=r.substring(c+1)}}},C=0,k=m;C<k.length;C++)D();document.body.appendChild(l);case 23:case"end":return r.stop()}}),r)}))(),"t0",3);case 3:r.next=8;break;case 5:r.prev=5,r.t1=r.catch(1),e._onLog&&e._onLog(r.t1.message||r.t1);case 8:case"end":return r.stop()}}),r,null,[[1,5]])})))}},{key:"createInstanceInWorker",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return T(this,void 0,void 0,u().mark((function n(){return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.loadWasm();case 2:return n.next=4,new Promise((function(n,r){var i=e._nextTaskID++;e._taskCallbackMap.set(i,(function(e){if(e.success)return n(e.instanceID);var t=new Error(e.message);return t.stack=e.stack+"\n"+t.stack,r(t)})),e._dbrWorker.postMessage({type:"createInstance",id:i,bScanner:t})}));case 4:return n.abrupt("return",n.sent);case 5:case"end":return n.stop()}}),n)})))}},{key:"createInstance",value:function(){return T(this,void 0,void 0,u().mark((function t(){var n;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new e,t.next=3,e.createInstanceInWorker();case 3:return n._instanceID=t.sent,t.abrupt("return",n);case 5:case"end":return t.stop()}}),t)})))}},{key:"fixResultLocationWhenFilterRegionInJs",value:function(e,t,n,r,i,s,a,o){if(e&&t.length>0){var c,u=(0,v.Z)(t);try{for(u.s();!(c=u.n()).done;){var d=c.value.localizationResult;2==d.resultCoordinateType&&(d.x1*=.01*a,d.x2*=.01*a,d.x3*=.01*a,d.x4*=.01*a,d.y1*=.01*o,d.y2*=.01*o,d.y3*=.01*o,d.y4*=.01*o);var l=a/i,_=o/s;d.x1=d.x1/l+n,d.x2=d.x2/l+n,d.x3=d.x3/l+n,d.x4=d.x4/l+n,d.y1=d.y1/_+r,d.y2=d.y2/_+r,d.y3=d.y3/_+r,d.y4=d.y4/_+r,2==d.resultCoordinateType&&(d.x1*=100/i,d.x2*=100/i,d.x3*=100/i,d.x4*=100/i,d.y1*=100/s,d.y2*=100/s,d.y3*=100/s,d.y4*=100/s)}}catch(h){u.e(h)}finally{u.f()}}}},{key:"BarcodeReaderException",value:function(e,t){var n,r=A.DBR_UNKNOWN;return"number"==typeof e?(r=e,n=new Error(t)):n=new Error(e),n.code=r,n}}]),e}();k._jsVersion="8.8.7",k._jsEditVersion="20220125",k._version="loading...(JS "+k._jsVersion+"."+k._jsEditVersion+")",k._license=!D&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",k._sessionPassword=!D&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword")||"",k.browserInfo=function(){if(!D){var e={init:function(){this.browser=this.searchString(this.dataBrowser)||"unknownBrowser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"unknownVersion",this.OS=this.searchString(this.dataOS)||"unknownOS","Linux"==this.OS&&-1!=navigator.userAgent.indexOf("Windows NT")&&(this.OS="HarmonyOS")},searchString:function(e){for(var t=0;t<e.length;t++){var n=e[t].string,r=e[t].prop;if(this.versionSearchString=e[t].versionSearch||e[t].identity,n){if(-1!=n.indexOf(e[t].subString))return e[t].identity}else if(r)return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(-1!=t)return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Edge",identity:"Edge"},{string:navigator.userAgent,subString:"OPR",identity:"OPR"},{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"}],dataOS:[{string:navigator.userAgent,subString:"HarmonyOS",identity:"HarmonyOS"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone"},{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};return e.init(),{browser:e.browser,version:e.version,OS:e.OS}}if(D)return{browser:"ssr",version:0,OS:"ssr"}}(),k._workerName="dbr-"+k._jsVersion+".worker.js",k._engineResourcePath=function(){if(!D&&document.currentScript){var e=document.currentScript.src,t=e.indexOf("?");if(-1!=t)e=e.substring(0,t);else{var n=e.indexOf("#");-1!=n&&(e=e.substring(0,n))}return e.substring(0,e.lastIndexOf("/")+1)}return"./"}(),k._licenseServer=[],k._deviceFriendlyName="",k._isShowRelDecodeTimeInResults=!1,k._bWasmDebug=!1,k._bNeverShowDialog=!1,k.__bUseFullFeature=!0,k._nextTaskID=0,k._taskCallbackMap=new Map,k._loadWasmStatus="unload",k._loadWasmCallbackArr=[],k._lastErrorCode=0,k._lastErrorString="",k._setWarnnedEx=new Set,k._loadWasmErr=null,"object"==typeof n.g&&n.g.process&&n.g.process.release&&n.g.process.release.name;var L,M,x,O,w,N,B,P,F,U,V,G,W,H,Z,K,J,Q,Y,j,X,z,q,$,ee,te,ne,re=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,i.Z)(this,n),(e=t.call(this))._clickIptSingleFrameMode=function(){},e.intervalTime=0,e.bSaveOriCanvas=!1,e._intervalGetVideoFrame=0,e.array_getFrameTimeCost=[],e.array_decodeFrameTimeCost=[],e._indexCurrentDecodingFrame=0,e._bPauseScan=!1,e._intervalDetectVideoPause=1e3,e._cvsDrawArea=null,e._divScanArea=null,e._divScanLight=null,e._selCam=null,e._selRsl=null,e._btnClose=null,e._soundOnSuccessfullRead=new Audio("data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"),e.bPlaySoundOnSuccessfulRead=!1,e.bVibrateOnSuccessfulRead=!1,e.vibrateDuration=300,e.regionMaskFillStyle="rgba(0,0,0,0.5)",e.regionMaskStrokeStyle="rgb(254,142,20)",e.regionMaskLineWidth=2,e.barcodeFillStyle="rgba(254,180,32,0.3)",e.barcodeStrokeStyle="rgba(254,180,32,0.9)",e.barcodeLineWidth=1,e.beingLazyDrawRegionsults=!1,e.dce=null,e._onCameraSelChange=function(){e._divScanLight&&(e._divScanLight.style.display="none"),e._drawRegionsults(),e.array_decodeFrameTimeCost.length=0,e.array_getFrameTimeCost.length=0,e._intervalGetVideoFrame=0},e._onResolutionSelChange=function(){e._divScanLight&&(e._divScanLight.style.display="none"),e._drawRegionsults(),e.array_decodeFrameTimeCost.length=0,e.array_getFrameTimeCost.length=0,e._intervalGetVideoFrame=0},e._onCloseBtnClick=function(){e.hide()},e}return(0,s.Z)(n,[{key:"getUIElement",value:function(){return this.dce.getUIElement()}},{key:"setUIElement",value:function(e){return T(this,void 0,void 0,u().mark((function t(){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.dce.setUIElement(e);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"singleFrameMode",get:function(){return this.dce.singleFrameMode},set:function(e){var t=this;this.dce.singleFrameMode=e,e&&T(t,void 0,void 0,u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getScanSettings();case 2:return(t=e.sent).oneDTrustFrameCount=1,e.next=6,this.updateScanSettings(t);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"ifSaveOriginalImageInACanvas",get:function(){return this.bSaveOriCanvas},set:function(e){this.bSaveOriCanvas=e,this.dce&&(this.dce.ifSaveOriginalImageInACanvas=e)}},{key:"_assertOpen",value:function(){if(!this.dce.isOpen())throw Error("The scanner is not open.")}},{key:"soundOnSuccessfullRead",get:function(){return this._soundOnSuccessfullRead},set:function(e){e instanceof HTMLAudioElement?this._soundOnSuccessfullRead=e:this._soundOnSuccessfullRead=new Audio(e)}},{key:"whenToPlaySoundforSuccessfulRead",get:function(){return!0===this.bPlaySoundOnSuccessfulRead?"frame":this.bPlaySoundOnSuccessfulRead?this.bPlaySoundOnSuccessfulRead:"never"},set:function(e){this.bPlaySoundOnSuccessfulRead="never"!==e&&e}},{key:"whenToVibrateforSuccessfulRead",get:function(){return!0===this.bVibrateOnSuccessfulRead?"frame":this.bVibrateOnSuccessfulRead?this.bVibrateOnSuccessfulRead:"never"},set:function(e){this.bVibrateOnSuccessfulRead="never"!==e&&e}},{key:"region",get:function(){return this._region},set:function(e){var t=this;this._region=e,this.dce&&(this.dce.region=e),this.singleFrameMode||(this.beingLazyDrawRegionsults=!0,setTimeout((function(){t.beingLazyDrawRegionsults&&t._drawRegionsults()}),500)),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}},{key:"createDCEInstance",value:function(){return T(this,void 0,void 0,u().mark((function e(){var t=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.dce,e.t0){e.next=14;break}return k._onLog&&k._onLog("createDCEInstance()"),E.defaultUIElementURL=null,e.next=6,E.createInstance();case 6:this.dce=e.sent,this.dce.bChangeRegionIndexManually=!0,this.dce.regionIndex=0,this.dce.bufferRefreshInterval=200,this.dce.alwaysRefreshBuffer=!1,this.dce.ifSaveOriginalImageInACanvas=!1,this.dce.onSingleFrameAcquired=function(e){return T(t,void 0,void 0,u().mark((function t(){var n,r,i,s,a,o;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.decode(e);case 2:return n=t.sent,t.next=5,this.clearMapDecodeRecord();case 5:r=(0,v.Z)(n);try{for(r.s();!(i=r.n()).done;)delete i.value.bUnduplicated}catch(c){r.e(c)}finally{r.f()}if(this._drawRegionsults(n),this.onFrameRead&&this.isOpen()&&!this._bPauseScan&&this.onFrameRead(n),this.onUniqueRead&&this.isOpen()&&!this._bPauseScan){s=(0,v.Z)(n);try{for(s.s();!(a=s.n()).done;)o=a.value,this.onUniqueRead(o.barcodeText,o)}catch(c){s.e(c)}finally{s.f()}}case 8:case"end":return t.stop()}}),t,this)})))},this._clickIptSingleFrameMode=this.dce._clickIptSingleFrameMode;case 14:case"end":return e.stop()}}),e,this)})))}},{key:"decode",value:function(e){return g((0,h.Z)(n.prototype),"decode",this).call(this,e)}},{key:"decodeBase64String",value:function(e){return g((0,h.Z)(n.prototype),"decodeBase64String",this).call(this,e)}},{key:"decodeUrl",value:function(e){return g((0,h.Z)(n.prototype),"decodeUrl",this).call(this,e)}},{key:"decodeBuffer",value:function(e,t,r,i,s,a){return g((0,h.Z)(n.prototype),"decodeBuffer",this).call(this,e,t,r,i,s,a)}},{key:"decodeCurrentFrame",value:function(e){return T(this,void 0,void 0,u().mark((function t(){var n,r,i,s,a,o,c,d,l,_,h,f,g;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._assertOpen(),n=null,e&&e.region&&(n=e.region),!(r=this.dce.getFrame(n))||null!==r.canvas){t.next=9;break}return i=r.data,s=r.width,a=r.height,t.next=8,this._decodeBuffer_Uint8Array(i,s,a,s,I.IPF_GrayScaled);case 8:return t.abrupt("return",t.sent);case 9:if(!r||!r.canvas){t.next=16;break}return o=r.data,c=r.canvas,d=r.region,l=r.sx,_=r.sy,h=r.sWidth,f=r.sHeight,(this.bSaveOriCanvas||this.singleFrameMode)&&(this.oriCanvas=c),t.next=14,this._decodeBuffer_Uint8Array(o,c.width,c.height,4*c.width,I.IPF_ABGR_8888);case 14:return g=t.sent,t.abrupt("return",(k.fixResultLocationWhenFilterRegionInJs(d,g,l,_,h,f,c.width,c.height),g));case 16:case"end":return t.stop()}}),t,this)})))}},{key:"clearMapDecodeRecord",value:function(){return T(this,void 0,void 0,u().mark((function e(){var t=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){var r=k._nextTaskID++;k._taskCallbackMap.set(r,(function(t){if(t.success)return e();var r=new Error(t.message);return r.stack=t.stack+"\n"+r.stack,n(r)})),k._dbrWorker.postMessage({type:"clearMapDecodeRecord",id:r,instanceID:t._instanceID})}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))}},{key:"updateRuntimeSettings",value:function(e){return T(this,void 0,void 0,u().mark((function t(){var r,i,s,a,o,c,d,l,_,h=this;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("string"!=typeof e){t.next=72;break}if("speed"!=e){t.next=15;break}return t.next=4,this.getRuntimeSettings();case 4:return i=t.sent,t.next=7,this.resetRuntimeSettings();case 7:return t.next=9,this.getRuntimeSettings();case 9:(r=t.sent).barcodeFormatIds=i.barcodeFormatIds,r.barcodeFormatIds_2=i.barcodeFormatIds_2,n.isRegionSinglePreset(i.region)||(r.region=i.region),t.next=70;break;case 15:if("balance"!=e){t.next=33;break}return t.next=18,this.getRuntimeSettings();case 18:return s=t.sent,t.next=21,this.resetRuntimeSettings();case 21:return t.next=23,this.getRuntimeSettings();case 23:(r=t.sent).barcodeFormatIds=s.barcodeFormatIds,r.barcodeFormatIds_2=s.barcodeFormatIds_2,n.isRegionSinglePreset(s.region)||(r.region=s.region),r.deblurLevel=3,r.expectedBarcodesCount=512,r.localizationModes=[2,16,0,0,0,0,0,0],r.timeout=1e5,t.next=70;break;case 33:if("coverage"!=e){t.next=52;break}return t.next=36,this.getRuntimeSettings();case 36:return a=t.sent,t.next=39,this.resetRuntimeSettings();case 39:return t.next=41,this.getRuntimeSettings();case 41:(r=t.sent).barcodeFormatIds=a.barcodeFormatIds,r.barcodeFormatIds_2=a.barcodeFormatIds_2,n.isRegionSinglePreset(a.region)||(r.region=a.region),r.deblurLevel=5,r.expectedBarcodesCount=512,r.scaleDownThreshold=1e5,r.localizationModes=[2,16,4,8,0,0,0,0],r.timeout=1e5,t.next=70;break;case 52:if("single"!=e){t.next=69;break}return t.next=55,this.getRuntimeSettings();case 55:return o=t.sent,t.next=58,this.resetRuntimeSettings();case 58:return t.next=60,this.getRuntimeSettings();case 60:(r=t.sent).barcodeFormatIds=o.barcodeFormatIds,r.barcodeFormatIds_2=o.barcodeFormatIds_2,n.isRegionNormalPreset(o.region)?r.region=JSON.parse(JSON.stringify(n.singlePresetRegion)):r.region=o.region,r.expectedBarcodesCount=1,r.localizationModes=[16,2,0,0,0,0,0,0],r.barcodeZoneMinDistanceToImageBorders=0,t.next=70;break;case 69:r=JSON.parse(e);case 70:t.next=75;break;case 72:if("object"==typeof e){t.next=74;break}throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");case 74:(r=JSON.parse(JSON.stringify(e))).region instanceof Array&&[(c=e.region).regionLeft,c.regionTop,c.regionLeft,c.regionBottom,c.regionMeasuredByPercentage].some((function(e){return void 0!==e}))&&(r.region={regionLeft:c.regionLeft||0,regionTop:c.regionTop||0,regionRight:c.regionRight||0,regionBottom:c.regionBottom||0,regionMeasuredByPercentage:c.regionMeasuredByPercentage||0});case 75:if(k._bUseFullFeature){t.next=80;break}if(0==(r.barcodeFormatIds&~(b.BF_ONED|b.BF_QR_CODE|b.BF_PDF417|b.BF_DATAMATRIX))&&0==r.barcodeFormatIds_2){t.next=78;break}throw Error("Some of the specified barcode formats are not supported in the compact version. Please try the full-featured version.");case 78:if(0==r.intermediateResultTypes){t.next=80;break}throw Error("Intermediate results is not supported in the compact version. Please try the full-featured version.");case 80:if(d=r.region,this.bFilterRegionInJs?this.userDefinedRegion=JSON.parse(JSON.stringify(d)):this.userDefinedRegion=null,d instanceof Array)if(d.length){for(l=0;l<d.length;++l)(_=d[l])&&((_.regionLeft||_.regionTop||_.regionRight||_.regionBottom||_.regionMeasuredByPercentage)&&(_.regionLeft||_.regionTop||100!=_.regionRight||100!=_.regionBottom||!_.regionMeasuredByPercentage)||(d[l]=null));this.region=d}else this.region=null;else(d.regionLeft||d.regionTop||d.regionRight||d.regionBottom||d.regionMeasuredByPercentage)&&(d.regionLeft||d.regionTop||100!=d.regionRight||100!=d.regionBottom||!d.regionMeasuredByPercentage)?this.region=d:this.region=null;return this.bFilterRegionInJs&&(r.region={regionLeft:0,regionTop:0,regionRight:0,regionBottom:0,regionMeasuredByPercentage:0}),t.next=85,new Promise((function(e,t){var n=k._nextTaskID++;k._taskCallbackMap.set(n,(function(n){if(n.success){try{h._handleRetJsonString(n.updateReturn)}catch(e){t(e)}return e()}var r=new Error(n.message);return r.stack=n.stack+"\n"+r.stack,t(r)})),k._dbrWorker.postMessage({type:"updateRuntimeSettings",id:n,instanceID:h._instanceID,body:{settings:JSON.stringify(r)}})}));case 85:if(t.t0="single"==e,!t.t0){t.next=95;break}return t.next=89,this.setModeArgument("BinarizationModes",0,"EnableFillBinaryVacancy","0");case 89:return t.next=91,this.setModeArgument("LocalizationModes",0,"ScanDirection","2");case 91:return t.next=93,this.setModeArgument("BinarizationModes",0,"BlockSizeX","71");case 93:return t.next=95,this.setModeArgument("BinarizationModes",0,"BlockSizeY","71");case 95:case"end":return t.stop()}}),t,this)})))}},{key:"_bindUI",value:function(){var e=this.getUIElement();if(!e)throw new Error("Need to define `UIElement` before opening.");for(var t=[e],n=0;n<t.length;++n){var r,i=(0,v.Z)(t[n].children);try{for(i.s();!(r=i.n()).done;){var s=r.value;t.push(s)}}catch(u){i.e(u)}finally{i.f()}}for(var a=0,o=t;a<o.length;a++){var c=o[a];this.dce._video||!c.classList.contains("dce-video")&&!c.classList.contains("dbrScanner-video")?this.dce._bgLoading||!c.classList.contains("dce-bg-loading")&&!c.classList.contains("dbrScanner-bg-loading")?this.dce._bgCamera||!c.classList.contains("dce-bg-camera")&&!c.classList.contains("dbrScanner-bg-camera")?!this._cvsDrawArea&&c.classList.contains("dbrScanner-cvs-drawarea")?this._cvsDrawArea=c:!this._divScanArea&&c.classList.contains("dbrScanner-cvs-scanarea")?this._divScanArea=c:!this._divScanLight&&c.classList.contains("dbrScanner-scanlight")?this._divScanLight=c:this.dce._selCam||!c.classList.contains("dce-sel-camera")&&!c.classList.contains("dbrScanner-sel-camera")?!this.dce._selRsl&&c.classList.contains("dbrScanner-sel-resolution")?(this.dce._selRsl=c,this.dce._selRsl.options.length||(this.dce._selRsl.innerHTML=[this.dce._optGotRsl?"":'<option class="dbrScanner-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">ask 1920 x 1080</option>','<option data-width="1280" data-height="720">ask 1280 x 720</option>','<option data-width="640" data-height="480">ask 640 x 480</option>'].join(""),this.dce._optGotRsl=this.dce._optGotRsl||this.dce._selRsl.options[0])):this.dce._optGotRsl||!c.classList.contains("dce-opt-gotResolution")&&!c.classList.contains("dbrScanner-opt-gotResolution")?this.dce._btnClose||!c.classList.contains("dce-btn-close")&&!c.classList.contains("dbrScanner-btn-close")?this.dce._video||!c.classList.contains("dce-existingVideo")&&!c.classList.contains("dbrScanner-existingVideo")||(this.dce._video=c,this.dce._video.setAttribute("playsinline","true"),this.dce.singleFrameMode=!1):this.dce._btnClose=c:this.dce._optGotRsl=c:this.dce._selCam=c:this.dce._bgCamera=c:this.dce._bgLoading=c:(this.dce._video=c,this.dce._video.setAttribute("playsinline","true"))}if(this.dce._bindUI(),this._selCam=this.dce._selCam,this._selRsl=this.dce._selRsl,this._btnClose=this.dce._btnClose,this.singleFrameMode&&(this._cvsDrawArea&&(this._cvsDrawArea.addEventListener("click",this._clickIptSingleFrameMode),this._cvsDrawArea.style.cursor="pointer",this._cvsDrawArea.setAttribute("title","Take a photo")),this._divScanArea&&(this._divScanArea.addEventListener("click",this._clickIptSingleFrameMode),this._divScanArea.style.cursor="pointer",this._divScanArea.setAttribute("title","Take a photo"))),this._selCam&&this._selCam.addEventListener("change",this._onCameraSelChange),this._selRsl&&this._selRsl.addEventListener("change",this._onResolutionSelChange),this._btnClose&&this._btnClose.addEventListener("click",this._onCloseBtnClick),!this.dce.video)throw this._unbindUI(),Error("Can not find HTMLVideoElement with class `dbrScanner-video`.")}},{key:"_unbindUI",value:function(){this._clearRegionsults(),this.singleFrameMode&&(this._cvsDrawArea&&(this._cvsDrawArea.removeEventListener("click",this._clickIptSingleFrameMode),this._cvsDrawArea.style.cursor="",this._cvsDrawArea.removeAttribute("title")),this._divScanArea&&(this._divScanArea.removeEventListener("click",this._clickIptSingleFrameMode),this._divScanArea.style.cursor="",this._divScanArea.removeAttribute("title"))),this._selCam&&this._selCam.removeEventListener("change",this._onCameraSelChange),this._selRsl&&this._selRsl.removeEventListener("change",this._onResolutionSelChange),this._btnClose&&this._btnClose.removeEventListener("click",this._onCloseBtnClick),this.dce._unbindUI(),this._cvsDrawArea=null,this._divScanArea=null,this._divScanLight=null,this._selCam=null,this._selRsl=null,this._btnClose=null}},{key:"onPlayed",get:function(){return this.dce.onPlayed},set:function(e){this.dce.onPlayed=e}},{key:"onUnduplicatedRead",get:function(){return this.onUniqueRead},set:function(e){this.onUniqueRead=e}},{key:"getAllCameras",value:function(){return T(this,void 0,void 0,u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.dce.getAllCameras());case 1:case"end":return e.stop()}}),e,this)})))}},{key:"getCurrentCamera",value:function(){return T(this,void 0,void 0,u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.dce.getSelectedCamera());case 1:case"end":return e.stop()}}),e,this)})))}},{key:"setCurrentCamera",value:function(e){return T(this,void 0,void 0,u().mark((function t(){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.dce.selectCamera(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"getResolution",value:function(){return this.dce.getResolution()}},{key:"setResolution",value:function(e,t){return T(this,void 0,void 0,u().mark((function n(){return u().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.dce.setResolution(e,t));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"getScanSettings",value:function(){return T(this,void 0,void 0,u().mark((function e(){var t=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){var r=k._nextTaskID++;k._taskCallbackMap.set(r,(function(r){if(r.success){var i=r.results;return i.intervalTime=t.intervalTime,e(i)}var s=new Error(r.message);return s.stack+="\n"+r.stack,n(s)})),k._dbrWorker.postMessage({type:"getScanSettings",id:r,instanceID:t._instanceID})}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))}},{key:"updateScanSettings",value:function(e){return T(this,void 0,void 0,u().mark((function t(){var r=this;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.intervalTime=e.intervalTime,t.next=3,new Promise((function(t,i){var s=k._nextTaskID++;k._taskCallbackMap.set(s,(function(e){if(e.success)return t();var n=new Error(e.message);return n.stack+="\n"+e.stack,i(n)})),n._dbrWorker.postMessage({type:"updateScanSettings",id:s,instanceID:r._instanceID,body:{settings:e}})}));case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"getVideoSettings",value:function(){return this.dce.getVideoSettings()}},{key:"updateVideoSettings",value:function(e){return this.dce.updateVideoSettings(e)}},{key:"isOpen",value:function(){return this.dce&&this.dce.isOpen()}},{key:"_show",value:function(){var e=this.getUIElement();e.parentNode||(e.style.position="fixed",e.style.left="0",e.style.top="0",document.body.append(e)),"none"==e.style.display&&(e.style.display="")}},{key:"stop",value:function(){this.dce.stop(),this._divScanLight&&(this._divScanLight.style.display="none"),this._drawRegionsults(),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}},{key:"pause",value:function(){this.dce.pause(),this._divScanLight&&(this._divScanLight.style.display="none")}},{key:"play",value:function(e,t,n){return T(this,void 0,void 0,u().mark((function r(){return u().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.dce.play(e,t,n));case 1:case"end":return r.stop()}}),r,this)})))}},{key:"pauseScan",value:function(){this._assertOpen(),this._bPauseScan=!0,this._divScanLight&&(this._divScanLight.style.display="none")}},{key:"resumeScan",value:function(){this._assertOpen(),this._bPauseScan=!1}},{key:"getCapabilities",value:function(){return this.dce.getCapabilities()}},{key:"getCameraSettings",value:function(){return this.dce.getCameraSettings()}},{key:"getConstraints",value:function(){return this.dce.getConstraints()}},{key:"applyConstraints",value:function(e){return T(this,void 0,void 0,u().mark((function t(){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.dce.applyConstraints(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"turnOnTorch",value:function(){return T(this,void 0,void 0,u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.dce.turnOnTorch());case 1:case"end":return e.stop()}}),e,this)})))}},{key:"turnOffTorch",value:function(){return T(this,void 0,void 0,u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.dce.turnOffTorch());case 1:case"end":return e.stop()}}),e,this)})))}},{key:"setColorTemperature",value:function(e){return T(this,void 0,void 0,u().mark((function t(){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.dce.setColorTemperature(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"setExposureCompensation",value:function(e){return T(this,void 0,void 0,u().mark((function t(){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.dce.setExposureCompensation(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"setZoom",value:function(e){return T(this,void 0,void 0,u().mark((function t(){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.dce.setZoom(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"setFrameRate",value:function(e){return T(this,void 0,void 0,u().mark((function t(){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.dce.setFrameRate(e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"getFrameRate",value:function(){return this.dce.getFrameRate()}},{key:"_cloneDecodeResults",value:function(e){if(e instanceof Array){var t,n=[],r=(0,v.Z)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n.push(this._cloneDecodeResults(i))}}catch(a){r.e(a)}finally{r.f()}return n}var s=e;return JSON.parse(JSON.stringify(s,(function(e,t){return"oriVideoCanvas"==e||"searchRegionCanvas"==e?void 0:t})))}},{key:"_loopReadVideo",value:function(){return T(this,void 0,void 0,u().mark((function e(){var t,n=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.bDestroyed){e.next=2;break}return e.abrupt("return",void this.dce.stopFetchingLoop());case 2:if(this.isOpen()){e.next=7;break}return this.dce.stopFetchingLoop(),e.next=6,this.clearMapDecodeRecord();case 6:return e.abrupt("return",void e.sent);case 7:if(this.dce.video&&!this.dce.video.paused&&!this._bPauseScan){e.next=14;break}return k._onLog&&k._onLog("Video or scan is paused. Ask in 1s."),this.dce.stopFetchingLoop(),e.next=12,this.clearMapDecodeRecord();case 12:return this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),e.abrupt("return",void(this._loopReadVideoTimeoutId=setTimeout((function(){n._loopReadVideo()}),this._intervalDetectVideoPause)));case 14:if(this._divScanLight&&"none"==this._divScanLight.style.display&&(this._divScanLight.style.display=""),k._onLog&&k._onLog("======= once read ======="),k._onLog&&(this._timeStartDecode=Date.now()),t=this._getVideoFrame()){e.next=18;break}return e.abrupt("return",(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout((function(){n._loopReadVideo()}),0))));case 18:T(n,void 0,void 0,u().mark((function e(){var n,r,i,s,a,o,c,d,l,_,h,f,g,v,p,m;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||null!==t.canvas){e.next=5;break}return n=t.data,r=t.width,i=t.height,s=t.timeStamp,a={timeStamp:s},e.next=4,this._decodeBuffer_Uint8Array(n,r,i,r,I.IPF_GrayScaled,a);case 4:return e.abrupt("return",e.sent);case 5:if(!t||!t.canvas){e.next=12;break}return o=t.data,c=t.canvas,d=t.region,l=t.sx,_=t.sy,h=t.width,f=t.height,g=t.timeStamp,v={timeStamp:g},(this.bSaveOriCanvas||this.singleFrameMode)&&(this.oriCanvas=c),e.next=10,this._decodeBuffer_Uint8Array(o,c.width,c.height,4*c.width,I.IPF_ABGR_8888,v);case 10:return p=e.sent,e.abrupt("return",(k.fixResultLocationWhenFilterRegionInJs(d,p,l,_,c.width,c.height,h,f),p));case 12:return m=new Error("imgData is empty."),e.abrupt("return",new Promise((function(e){return e(m)})));case 14:case"end":return e.stop()}}),e,this)}))).then((function(e){k._onLog&&k._onLog(e);var t=n.array_decodeFrameTimeCost,r=n.array_getFrameTimeCost,i=n._indexCurrentDecodingFrame;if(function(){if(n.region instanceof Array){for(t[i]&&t[i]instanceof Array||(t[i]=[]);t[i].length>=5;)t[i].shift();t[i].push(n._lastInnerDecodeDuration)}else{for(;t.length>=5;)t.shift();t.push(n._lastInnerDecodeDuration)}}(),n._intervalGetVideoFrame=function(){var e=0;if(n.region instanceof Array){var s,a;a=(s=i+1>=n.region.length?0:i+1)+1>=n.region.length?0:s+1,e=t[s]&&t[s].length&&r[a]&&r[a].length?Math.min.apply(Math,(0,_.Z)(t[s]))-Math.max.apply(Math,(0,_.Z)(r[a])):0}else if(r&&r.length){var o=Math.min.apply(Math,(0,_.Z)(t)),c=Math.max.apply(Math,(0,_.Z)(r));o&&c&&(e=o-c)}else e=0;return e>0?e:0}()+n.intervalTime,n.isOpen()&&n.dce.video&&!n.dce.video.paused&&!n._bPauseScan){if(n.bPlaySoundOnSuccessfulRead&&e.length){var s=!1;if(!0===n.bPlaySoundOnSuccessfulRead||"frame"===n.bPlaySoundOnSuccessfulRead)s=!0;else if("unduplicated"===n.bPlaySoundOnSuccessfulRead){var a,o=(0,v.Z)(e);try{for(o.s();!(a=o.n()).done;){if(a.value.bUnduplicated){s=!0;break}}}catch(R){o.e(R)}finally{o.f()}}s&&(n.soundOnSuccessfullRead.currentTime=0,n.soundOnSuccessfullRead.play().catch((function(e){console.warn("Autoplay not allowed. User interaction required: "+(e.message||e))})))}if(navigator.vibrate&&n.bVibrateOnSuccessfulRead&&e.length){var c=!1;if(!0===n.bVibrateOnSuccessfulRead||"frame"===n.bVibrateOnSuccessfulRead)c=!0;else if("unduplicated"===n.bVibrateOnSuccessfulRead){var u,d=(0,v.Z)(e);try{for(d.s();!(u=d.n()).done;){if(u.value.bUnduplicated){c=!0;break}}}catch(R){d.e(R)}finally{d.f()}}if(c)try{navigator.vibrate(n.vibrateDuration)}catch(e){console.warn("Vibration not allowed. User interaction required: "+(e.message||e))}}if(n.onFrameRead){var l,h=n._cloneDecodeResults(e),f=(0,v.Z)(h);try{for(f.s();!(l=f.n()).done;){delete l.value.bUnduplicated}}catch(R){f.e(R)}finally{f.f()}n.onFrameRead(h)}if(n.onUniqueRead){var g,p=(0,v.Z)(e);try{for(p.s();!(g=p.n()).done;){var m=g.value;m.bUnduplicated&&n.onUniqueRead(m.barcodeText,n._cloneDecodeResults(m))}}catch(R){p.e(R)}finally{p.f()}}n._drawRegionsults(e)}n._loopReadVideoTimeoutId&&clearTimeout(n._loopReadVideoTimeoutId),n.intervalTime?n._loopReadVideoTimeoutId=setTimeout((function(){n._loopReadVideo()}),n.intervalTime):n._loopReadVideo()})).catch((function(e){n.dce.stopFetchingLoop(),k._onLog&&k._onLog(e.message||e),n._loopReadVideoTimeoutId&&clearTimeout(n._loopReadVideoTimeoutId),n._loopReadVideoTimeoutId=setTimeout((function(){n._loopReadVideo()}),Math.max(n.intervalTime,1e3)),"platform error"==e.message||console.warn(e.message)}));case 19:case"end":return e.stop()}}),e,this)})))}},{key:"_getVideoFrame",value:function(){var e=this,t=this.dce.isFetchingLoopStarted();if(this.dce.loopInterval=this._intervalGetVideoFrame,t||this.dce.startFetchingLoop(),!this.dce.getQueueLength())return this.dce.loopInterval=0,null;var n=this.dce.getFrameFromBuffer();return this._indexCurrentDecodingFrame=this.dce.regionIndex,this.region instanceof Array&&this.dce.regionIndex++,function(t){var n=t.timeSpent,r=e.array_getFrameTimeCost;if(e.region instanceof Array){var i=e._indexCurrentDecodingFrame;for(r[i]&&r[i]instanceof Array||(r[i]=[]);r[i].length>=5;)r[i].shift();r[i].push(n)}else{for(;r.length>=5;)r.shift();r.push(n)}}(n),n}},{key:"_drawRegionsults",value:function(e){var t,n,r;if(this.beingLazyDrawRegionsults=!1,this.singleFrameMode){if(!this.oriCanvas)return;t="contain",n=this.oriCanvas.width,r=this.oriCanvas.height}else{if(!this.dce.video)return;t=this.dce.video.style.objectFit||"contain",n=this.dce.video.videoWidth,r=this.dce.video.videoHeight}var i=this.region;if(i&&(!i.regionLeft&&!i.regionRight&&!i.regionTop&&!i.regionBottom&&!i.regionMeasuredByPercentage||i instanceof Array?i=null:i.regionMeasuredByPercentage?i=i.regionLeft||i.regionRight||100!==i.regionTop||100!==i.regionBottom?{regionLeft:Math.round(i.regionLeft/100*n),regionTop:Math.round(i.regionTop/100*r),regionRight:Math.round(i.regionRight/100*n),regionBottom:Math.round(i.regionBottom/100*r)}:null:delete(i=JSON.parse(JSON.stringify(i))).regionMeasuredByPercentage),this._cvsDrawArea){this._cvsDrawArea.style.objectFit=t;var s=this._cvsDrawArea;s.width=n,s.height=r;var a=s.getContext("2d");if(i){a.fillStyle=this.regionMaskFillStyle,a.fillRect(0,0,s.width,s.height),a.globalCompositeOperation="destination-out",a.fillStyle="#000";var o=Math.round(this.regionMaskLineWidth/2);a.fillRect(i.regionLeft-o,i.regionTop-o,i.regionRight-i.regionLeft+2*o,i.regionBottom-i.regionTop+2*o),a.globalCompositeOperation="source-over",a.strokeStyle=this.regionMaskStrokeStyle,a.lineWidth=this.regionMaskLineWidth,a.rect(i.regionLeft,i.regionTop,i.regionRight-i.regionLeft,i.regionBottom-i.regionTop),a.stroke()}if(e){a.globalCompositeOperation="destination-over",a.fillStyle=this.barcodeFillStyle,a.strokeStyle=this.barcodeStrokeStyle,a.lineWidth=this.barcodeLineWidth,e=e||[];var c,u=(0,v.Z)(e);try{for(u.s();!(c=u.n()).done;){var d=c.value.localizationResult;a.beginPath(),a.moveTo(d.x1,d.y1),a.lineTo(d.x2,d.y2),a.lineTo(d.x3,d.y3),a.lineTo(d.x4,d.y4),a.fill(),a.beginPath(),a.moveTo(d.x1,d.y1),a.lineTo(d.x2,d.y2),a.lineTo(d.x3,d.y3),a.lineTo(d.x4,d.y4),a.closePath(),a.stroke()}}catch(R){u.e(R)}finally{u.f()}}this.singleFrameMode&&(a.globalCompositeOperation="destination-over",a.drawImage(this.oriCanvas,0,0))}if(this._divScanArea&&this.dce.video){var l=this.dce.video.offsetWidth,_=this.dce.video.offsetHeight,h=1;l/_<n/r?(h=l/n,this._divScanArea.style.left="0",this._divScanArea.style.top=Math.round((_-r*h)/2)+"px"):(h=_/r,this._divScanArea.style.left=Math.round((l-n*h)/2)+"px",this._divScanArea.style.top="0");var f=i?Math.round(i.regionLeft*h):0,g=i?Math.round(i.regionTop*h):0,p=i?Math.round(i.regionRight*h-f):Math.round(n*h),m=i?Math.round(i.regionBottom*h-g):Math.round(r*h);this._divScanArea.style.marginLeft=f+"px",this._divScanArea.style.marginTop=g+"px",this._divScanArea.style.width=p+"px",this._divScanArea.style.height=m+"px"}}},{key:"_clearRegionsults",value:function(){this._cvsDrawArea&&(this._cvsDrawArea.width=this._cvsDrawArea.height=0)}},{key:"open",value:function(){return T(this,void 0,void 0,u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._bindUI(),e.next=3,this.play();case 3:return t=e.sent,e.abrupt("return",(this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._drawRegionsults(),this._loopReadVideo()),t));case 5:case"end":return e.stop()}}),e,this)})))}},{key:"openVideo",value:function(){return T(this,void 0,void 0,u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._bindUI(),e.next=3,this.play();case 3:return t=e.sent,e.abrupt("return",(this._bPauseScan=!0,this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._drawRegionsults(),this._loopReadVideo()),t));case 5:case"end":return e.stop()}}),e,this)})))}},{key:"close",value:function(){return T(this,void 0,void 0,u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.stop(),this._unbindUI(),this._bPauseScan=!1;case 1:case"end":return e.stop()}}),e,this)})))}},{key:"show",value:function(){return T(this,void 0,void 0,u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._bindUI(),this._show(),e.next=3,this.play();case 3:return t=e.sent,e.abrupt("return",(this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._drawRegionsults(),this._loopReadVideo()),t));case 5:case"end":return e.stop()}}),e,this)})))}},{key:"showVideo",value:function(){return T(this,void 0,void 0,u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._bindUI(),this._show(),e.next=3,this.play();case 3:return t=e.sent,e.abrupt("return",(this._bPauseScan=!0,this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._drawRegionsults(),this._loopReadVideo()),t));case 5:case"end":return e.stop()}}),e,this)})))}},{key:"hide",value:function(){return T(this,void 0,void 0,u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.stop(),this._unbindUI(),this._bPauseScan=!1,this.getUIElement().style.display="none";case 1:case"end":return e.stop()}}),e,this)})))}},{key:"destroy",value:function(){return this.destroyContext()}},{key:"destroyContext",value:function(){var e=this,t=Object.create(null,{destroyContext:{get:function(){return g((0,h.Z)(n.prototype),"destroyContext",e)}}});return T(this,void 0,void 0,u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.close();case 2:if(e.t0=this.bDestroyed,e.t0){e.next=6;break}return e.next=6,t.destroyContext.call(this);case 6:case"end":return e.stop()}}),e,this)})))}}],[{key:"defaultUIElementURL",get:function(){var e;return null===(e=n._defaultUIElementURL)||void 0===e?void 0:e.replace("@engineResourcePath/",k.engineResourcePath)},set:function(e){n._defaultUIElementURL=e}},{key:"createInstance",value:function(e){return T(this,void 0,void 0,u().mark((function t(){var r,i;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new n,t.next=3,r.createDCEInstance();case 3:return t.next=5,n.createInstanceInWorker(!0);case 5:for(i in r._instanceID=t.sent,"string"==typeof e&&(e=JSON.parse(e)),e)r[i]=e[i];return t.next=10,r.setUIElement(n.defaultUIElementURL);case 10:if(r.singleFrameMode&&console.warn("The `navigator.mediaDevices.getUserMedia` is unavailable. automatically change to `singleFrameMode`."),t.t0=r.singleFrameMode,t.t0){t.next=15;break}return t.next=15,r.updateRuntimeSettings("single");case 15:return t.abrupt("return",r);case 16:case"end":return t.stop()}}),t)})))}},{key:"isRegionSinglePreset",value:function(e){return JSON.stringify(e)==JSON.stringify(n.singlePresetRegion)}},{key:"isRegionNormalPreset",value:function(e){return 0==e.regionLeft&&0==e.regionTop&&0==e.regionRight&&0==e.regionBottom&&0==e.regionMeasuredByPercentage}}]),n}(k);re._defaultUIElementURL="@engineResourcePath/dbr.scanner.html",re.singlePresetRegion=[null,{regionLeft:0,regionTop:30,regionRight:100,regionBottom:70,regionMeasuredByPercentage:1},{regionLeft:25,regionTop:25,regionRight:75,regionBottom:75,regionMeasuredByPercentage:1},{regionLeft:25,regionTop:25,regionRight:75,regionBottom:75,regionMeasuredByPercentage:1}],function(e){e[e.BICM_DARK_ON_LIGHT=1]="BICM_DARK_ON_LIGHT",e[e.BICM_LIGHT_ON_DARK=2]="BICM_LIGHT_ON_DARK",e[e.BICM_DARK_ON_DARK=4]="BICM_DARK_ON_DARK",e[e.BICM_LIGHT_ON_LIGHT=8]="BICM_LIGHT_ON_LIGHT",e[e.BICM_DARK_LIGHT_MIXED=16]="BICM_DARK_LIGHT_MIXED",e[e.BICM_DARK_ON_LIGHT_DARK_SURROUNDING=32]="BICM_DARK_ON_LIGHT_DARK_SURROUNDING",e[e.BICM_SKIP=0]="BICM_SKIP",e[e.BICM_REV=2147483648]="BICM_REV"}(L||(L={})),function(e){e[e.BCM_AUTO=1]="BCM_AUTO",e[e.BCM_GENERAL=2]="BCM_GENERAL",e[e.BCM_SKIP=0]="BCM_SKIP",e[e.BCM_REV=2147483648]="BCM_REV"}(M||(M={})),function(e){e[e.BF2_NULL=0]="BF2_NULL",e[e.BF2_POSTALCODE=32505856]="BF2_POSTALCODE",e[e.BF2_NONSTANDARD_BARCODE=1]="BF2_NONSTANDARD_BARCODE",e[e.BF2_USPSINTELLIGENTMAIL=1048576]="BF2_USPSINTELLIGENTMAIL",e[e.BF2_POSTNET=2097152]="BF2_POSTNET",e[e.BF2_PLANET=4194304]="BF2_PLANET",e[e.BF2_AUSTRALIANPOST=8388608]="BF2_AUSTRALIANPOST",e[e.BF2_RM4SCC=16777216]="BF2_RM4SCC",e[e.BF2_DOTCODE=2]="BF2_DOTCODE"}(x||(x={})),function(e){e[e.BM_AUTO=1]="BM_AUTO",e[e.BM_LOCAL_BLOCK=2]="BM_LOCAL_BLOCK",e[e.BM_SKIP=0]="BM_SKIP",e[e.BM_THRESHOLD=4]="BM_THRESHOLD",e[e.BM_REV=2147483648]="BM_REV"}(O||(O={})),function(e){e[e.ECCM_CONTRAST=1]="ECCM_CONTRAST"}(w||(w={})),function(e){e[e.CFM_GENERAL=1]="CFM_GENERAL"}(N||(N={})),function(e){e[e.CCM_AUTO=1]="CCM_AUTO",e[e.CCM_GENERAL_HSV=2]="CCM_GENERAL_HSV",e[e.CCM_SKIP=0]="CCM_SKIP",e[e.CCM_REV=2147483648]="CCM_REV"}(B||(B={})),function(e){e[e.CICM_GENERAL=1]="CICM_GENERAL",e[e.CICM_SKIP=0]="CICM_SKIP",e[e.CICM_REV=2147483648]="CICM_REV"}(P||(P={})),function(e){e[e.CM_IGNORE=1]="CM_IGNORE",e[e.CM_OVERWRITE=2]="CM_OVERWRITE"}(F||(F={})),function(e){e[e.DM_SKIP=0]="DM_SKIP",e[e.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",e[e.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",e[e.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",e[e.DM_SMOOTHING=8]="DM_SMOOTHING",e[e.DM_MORPHING=16]="DM_MORPHING",e[e.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",e[e.DM_SHARPENING=64]="DM_SHARPENING",e[e.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",e[e.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING"}(U||(U={})),function(e){e[e.DRM_AUTO=1]="DRM_AUTO",e[e.DRM_GENERAL=2]="DRM_GENERAL",e[e.DRM_SKIP=0]="DRM_SKIP",e[e.DRM_REV=2147483648]="DRM_REV"}(V||(V={})),function(e){e[e.DPMCRM_AUTO=1]="DPMCRM_AUTO",e[e.DPMCRM_GENERAL=2]="DPMCRM_GENERAL",e[e.DPMCRM_SKIP=0]="DPMCRM_SKIP",e[e.DPMCRM_REV=2147483648]="DPMCRM_REV"}(G||(G={})),function(e){e[e.GTM_INVERTED=1]="GTM_INVERTED",e[e.GTM_ORIGINAL=2]="GTM_ORIGINAL",e[e.GTM_SKIP=0]="GTM_SKIP",e[e.GTM_REV=2147483648]="GTM_REV"}(W||(W={})),function(e){e[e.IPM_AUTO=1]="IPM_AUTO",e[e.IPM_GENERAL=2]="IPM_GENERAL",e[e.IPM_GRAY_EQUALIZE=4]="IPM_GRAY_EQUALIZE",e[e.IPM_GRAY_SMOOTH=8]="IPM_GRAY_SMOOTH",e[e.IPM_SHARPEN_SMOOTH=16]="IPM_SHARPEN_SMOOTH",e[e.IPM_MORPHOLOGY=32]="IPM_MORPHOLOGY",e[e.IPM_SKIP=0]="IPM_SKIP",e[e.IPM_REV=2147483648]="IPM_REV"}(H||(H={})),function(e){e[e.IRSM_MEMORY=1]="IRSM_MEMORY",e[e.IRSM_FILESYSTEM=2]="IRSM_FILESYSTEM",e[e.IRSM_BOTH=4]="IRSM_BOTH"}(Z||(Z={})),function(e){e[e.IRT_NO_RESULT=0]="IRT_NO_RESULT",e[e.IRT_ORIGINAL_IMAGE=1]="IRT_ORIGINAL_IMAGE",e[e.IRT_COLOUR_CLUSTERED_IMAGE=2]="IRT_COLOUR_CLUSTERED_IMAGE",e[e.IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE=4]="IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE",e[e.IRT_TRANSFORMED_GRAYSCALE_IMAGE=8]="IRT_TRANSFORMED_GRAYSCALE_IMAGE",e[e.IRT_PREDETECTED_REGION=16]="IRT_PREDETECTED_REGION",e[e.IRT_PREPROCESSED_IMAGE=32]="IRT_PREPROCESSED_IMAGE",e[e.IRT_BINARIZED_IMAGE=64]="IRT_BINARIZED_IMAGE",e[e.IRT_TEXT_ZONE=128]="IRT_TEXT_ZONE",e[e.IRT_CONTOUR=256]="IRT_CONTOUR",e[e.IRT_LINE_SEGMENT=512]="IRT_LINE_SEGMENT",e[e.IRT_FORM=1024]="IRT_FORM",e[e.IRT_SEGMENTATION_BLOCK=2048]="IRT_SEGMENTATION_BLOCK",e[e.IRT_TYPED_BARCODE_ZONE=4096]="IRT_TYPED_BARCODE_ZONE",e[e.IRT_PREDETECTED_QUADRILATERAL=8192]="IRT_PREDETECTED_QUADRILATERAL"}(K||(K={})),function(e){e[e.LM_SKIP=0]="LM_SKIP",e[e.LM_AUTO=1]="LM_AUTO",e[e.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",e[e.LM_LINES=8]="LM_LINES",e[e.LM_STATISTICS=4]="LM_STATISTICS",e[e.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",e[e.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",e[e.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",e[e.LM_CENTRE=128]="LM_CENTRE",e[e.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",e[e.LM_REV=2147483648]="LM_REV"}(J||(J={})),function(e){e[e.PDFRM_RASTER=1]="PDFRM_RASTER",e[e.PDFRM_AUTO=2]="PDFRM_AUTO",e[e.PDFRM_VECTOR=4]="PDFRM_VECTOR",e[e.PDFRM_REV=2147483648]="PDFRM_REV"}(Q||(Q={})),function(e){e[e.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",e[e.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",e[e.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",e[e.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(Y||(Y={})),function(e){e[e.RPM_AUTO=1]="RPM_AUTO",e[e.RPM_GENERAL=2]="RPM_GENERAL",e[e.RPM_GENERAL_RGB_CONTRAST=4]="RPM_GENERAL_RGB_CONTRAST",e[e.RPM_GENERAL_GRAY_CONTRAST=8]="RPM_GENERAL_GRAY_CONTRAST",e[e.RPM_GENERAL_HSV_CONTRAST=16]="RPM_GENERAL_HSV_CONTRAST",e[e.RPM_SKIP=0]="RPM_SKIP",e[e.RPM_REV=2147483648]="RPM_REV"}(j||(j={})),function(e){e[e.RCT_PIXEL=1]="RCT_PIXEL",e[e.RCT_PERCENTAGE=2]="RCT_PERCENTAGE"}(X||(X={})),function(e){e[e.RT_STANDARD_TEXT=0]="RT_STANDARD_TEXT",e[e.RT_RAW_TEXT=1]="RT_RAW_TEXT",e[e.RT_CANDIDATE_TEXT=2]="RT_CANDIDATE_TEXT",e[e.RT_PARTIAL_TEXT=3]="RT_PARTIAL_TEXT"}(z||(z={})),function(e){e[e.SUM_AUTO=1]="SUM_AUTO",e[e.SUM_LINEAR_INTERPOLATION=2]="SUM_LINEAR_INTERPOLATION",e[e.SUM_NEAREST_NEIGHBOUR_INTERPOLATION=4]="SUM_NEAREST_NEIGHBOUR_INTERPOLATION",e[e.SUM_SKIP=0]="SUM_SKIP",e[e.SUM_REV=2147483648]="SUM_REV"}(q||(q={})),function(e){e[e.TP_REGION_PREDETECTED=1]="TP_REGION_PREDETECTED",e[e.TP_IMAGE_PREPROCESSED=2]="TP_IMAGE_PREPROCESSED",e[e.TP_IMAGE_BINARIZED=4]="TP_IMAGE_BINARIZED",e[e.TP_BARCODE_LOCALIZED=8]="TP_BARCODE_LOCALIZED",e[e.TP_BARCODE_TYPE_DETERMINED=16]="TP_BARCODE_TYPE_DETERMINED",e[e.TP_BARCODE_RECOGNIZED=32]="TP_BARCODE_RECOGNIZED"}($||($={})),function(e){e[e.TFM_AUTO=1]="TFM_AUTO",e[e.TFM_GENERAL_CONTOUR=2]="TFM_GENERAL_CONTOUR",e[e.TFM_SKIP=0]="TFM_SKIP",e[e.TFM_REV=2147483648]="TFM_REV"}(ee||(ee={})),function(e){e[e.TROM_CONFIDENCE=1]="TROM_CONFIDENCE",e[e.TROM_POSITION=2]="TROM_POSITION",e[e.TROM_FORMAT=4]="TROM_FORMAT",e[e.TROM_SKIP=0]="TROM_SKIP",e[e.TROM_REV=2147483648]="TROM_REV"}(te||(te={})),function(e){e[e.TDM_AUTO=1]="TDM_AUTO",e[e.TDM_GENERAL_WIDTH_CONCENTRATION=2]="TDM_GENERAL_WIDTH_CONCENTRATION",e[e.TDM_SKIP=0]="TDM_SKIP",e[e.TDM_REV=2147483648]="TDM_REV"}(ne||(ne={}));var ie=function(){function e(){(0,i.Z)(this,e)}return(0,s.Z)(e,null,[{key:"version",get:function(){return k.version}},{key:"productKeys",get:function(){return k.productKeys},set:function(e){k.productKeys=e}},{key:"handshakeCode",get:function(){return k.handshakeCode},set:function(e){k.handshakeCode=e}},{key:"organizationID",get:function(){return k.organizationID},set:function(e){k.organizationID=e}},{key:"sessionPassword",get:function(){return k.sessionPassword},set:function(e){k.sessionPassword=e}},{key:"browserInfo",get:function(){return k.browserInfo}},{key:"detectEnvironment",value:function(){return k.detectEnvironment()}},{key:"_workerName",get:function(){return k._workerName},set:function(e){k._workerName=e}},{key:"engineResourcePath",get:function(){return k.engineResourcePath},set:function(e){k.engineResourcePath=e}},{key:"licenseServer",get:function(){return k.licenseServer},set:function(e){k.licenseServer=e}},{key:"deviceFriendlyName",get:function(){return k.deviceFriendlyName},set:function(e){k.deviceFriendlyName=e}},{key:"_onLog",get:function(){return k._onLog},set:function(e){k._onLog=e}},{key:"_bWasmDebug",get:function(){return k._bWasmDebug},set:function(e){k._bWasmDebug=e}},{key:"_bUseFullFeature",get:function(){return k._bUseFullFeature},set:function(e){k._bUseFullFeature=e}},{key:"_dbrWorker",get:function(){return k._dbrWorker}},{key:"isLoaded",value:function(){return k.isLoaded()}},{key:"isWasmLoaded",value:function(){return k.isLoaded()}},{key:"loadWasm",value:function(){return k.loadWasm()}}]),e}();ie.DBR=ie,ie.BarcodeReader=k,ie.BarcodeScanner=re,ie.CameraEnhancer=y,ie.EnumBarcodeColourMode=L,ie.EnumBarcodeComplementMode=M,ie.EnumBarcodeFormat=b,ie.EnumBarcodeFormat_2=x,ie.EnumBinarizationMode=O,ie.EnumClarityCalculationMethod=w,ie.EnumClarityFilterMode=N,ie.EnumColourClusteringMode=B,ie.EnumColourConversionMode=P,ie.EnumConflictMode=F,ie.EnumDeblurMode=U,ie.EnumDeformationResistingMode=V,ie.EnumDPMCodeReadingMode=G,ie.EnumErrorCode=A,ie.EnumGrayscaleTransformationMode=W,ie.EnumImagePixelFormat=I,ie.EnumImagePreprocessingMode=H,ie.EnumIMResultDataType=S,ie.EnumIntermediateResultSavingMode=Z,ie.EnumIntermediateResultType=K,ie.EnumLocalizationMode=J,ie.EnumPDFReadingMode=Q,ie.EnumQRCodeErrorCorrectionLevel=Y,ie.EnumRegionPredetectionMode=j,ie.EnumResultCoordinateType=X,ie.EnumResultType=z,ie.EnumScaleUpMode=q,ie.EnumTerminatePhase=$,ie.EnumTextFilterMode=ee,ie.EnumTextResultOrderMode=te,ie.EnumTextureDetectionMode=ne,ie.engineResourcePath="https://cdn.jsdelivr.net/npm/dynamsoft-javascript-barcode@8.8.7/dist/";var se=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,i.Z)(this,n),t.apply(this,arguments)}return(0,s.Z)(n,[{key:"toggleTorch",value:function(){var e=(0,r.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,t.on?this.scanner.turnOnTorch():this.scanner.turnOffTorch(),e.next=7;break;case 4:throw e.prev=4,e.t0=e.catch(0),new Error("Torch unsupported");case 7:case"end":return e.stop()}}),e,this,[[0,4]])})));return function(t){return e.apply(this,arguments)}}()},{key:"stopScan",value:function(){var e=(0,r.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.scanner.hide();case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),e.t0;case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(){return e.apply(this,arguments)}}()},{key:"pauseScan",value:function(){var e=(0,r.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,this.scanner.pauseScan(),e.next=7;break;case 4:throw e.prev=4,e.t0=e.catch(0),e.t0;case 7:case"end":return e.stop()}}),e,this,[[0,4]])})));return function(){return e.apply(this,arguments)}}()},{key:"resumeScan",value:function(){var e=(0,r.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,this.scanner.resumeScan(),e.next=7;break;case 4:throw e.prev=4,e.t0=e.catch(0),e.t0;case 7:case"end":return e.stop()}}),e,this,[[0,4]])})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){var e=(0,r.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"initialize",value:function(){var e=(0,r.Z)(u().mark((function e(t){var n=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.scanner){e.next=12;break}return t&&(t.organizationID?(ie.BarcodeScanner.organizationID=t.organizationID,console.log("set organization ID")):t.license&&(ie.BarcodeScanner.productKeys=t.license)),e.next=4,ie.BarcodeScanner.createInstance();case 4:this.scanner=e.sent,this.scanner.onPlayed=function(e){n.notifyListeners("onPlayed",{resolution:e.width+"x"+e.height})},this.scanner.onFrameRead=function(e){for(var t=[],r=0;r<e.length;r++){var i,s=e[r];i={barcodeText:s.barcodeText,barcodeFormat:s.barcodeFormatString,barcodeBytesBase64:n.arrayBufferToBase64(s.barcodeBytes),x1:s.localizationResult.x1,y1:s.localizationResult.y1,x2:s.localizationResult.x2,y2:s.localizationResult.y2,x3:s.localizationResult.x3,y3:s.localizationResult.y3,x4:s.localizationResult.x4,y4:s.localizationResult.y4},t.push(i)}var a={results:t};n.notifyListeners("onFrameRead",a)},this.scanner.getUIElement().getElementsByClassName("dce-btn-close")[0].remove(),this.scanner.getUIElement().getElementsByClassName("dce-sel-camera")[0].remove(),this.scanner.getUIElement().getElementsByClassName("dce-sel-resolution")[0].remove(),e.next=13;break;case 12:console.log("Scanner already initialized.");case 13:return e.abrupt("return",{success:!0});case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setScanRegion",value:function(){var e=(0,r.Z)(u().mark((function e(t){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.scanner.getRuntimeSettings();case 2:return(n=e.sent).region.regionLeft=t.left,n.region.regionRight=t.right,n.region.regionTop=t.top,n.region.regionBottom=t.bottom,n.region.regionMeasuredByPercentage=t.measuredByPercentage,e.next=10,this.scanner.updateRuntimeSettings(n);case 10:return e.abrupt("return",{success:!0});case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"initRuntimeSettingsWithString",value:function(){var e=(0,r.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.template){e.next=4;break}return e.next=3,this.scanner.initRuntimeSettingsWithString(t.template);case 3:console.log("Using template: "+t.template);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"startScan",value:function(){var e=(0,r.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.scanner.show();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"arrayBufferToBase64",value:function(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,i=0;i<r;i++)t+=String.fromCharCode(n[i]);return window.btoa(t)}},{key:"getAllCameras",value:function(){var e=(0,r.Z)(u().mark((function e(){var t,n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.scanner.getAllCameras();case 2:return t=e.sent,n=[],t.forEach((function(e){n.push(e.label)})),e.abrupt("return",{cameras:n});case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"selectCamera",value:function(){var e=(0,r.Z)(u().mark((function e(t){var n=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.scanner.getAllCameras();case 2:return e.sent.forEach(function(){var e=(0,r.Z)(u().mark((function e(r){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.label!=t.cameraID){e.next=4;break}return e.next=3,n.scanner.setCurrentCamera(r);case 3:return e.abrupt("return",{success:!0});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",{message:"not found"});case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getSelectedCamera",value:function(){var e=(0,r.Z)(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.scanner.getCurrentCamera();case 2:return t=e.sent,e.abrupt("return",{selectedCamera:null===t||void 0===t?void 0:t.label});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getResolution",value:function(){var e=(0,r.Z)(u().mark((function e(){var t,n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.scanner.getResolution(),n=t[0]+"x"+t[1],e.abrupt("return",{resolution:n});case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setResolution",value:function(){var e=(0,r.Z)(u().mark((function e(t){var n,r,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.resolution,r=1280,i=720,n==l.F.RESOLUTION_480P?(r=640,i=480):n==l.F.RESOLUTION_720P?(r=1280,i=720):n==l.F.RESOLUTION_1080P?(r=1920,i=1080):n==l.F.RESOLUTION_2K?(r=2560,i=1440):n==l.F.RESOLUTION_4K&&(r=3840,i=2160),e.next=6,this.scanner.setResolution(r,i);case 6:return e.abrupt("return",{success:!0});case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setZoom",value:function(){var e=(0,r.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.scanner.setZoom(t.factor);case 2:return e.abrupt("return",{success:!0});case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setFocus",value:function(e){throw new Error("Method not implemented.")}}]),n}(d.Uw)}}]);
//# sourceMappingURL=2076.674e58e2.chunk.js.map